//
// Copyright 2020 FoxyUtils ehf. All rights reserved.
//
// This is a commercial product and requires a license to operate.
// A trial license can be obtained at https://unidoc.io
//
// DO NOT EDIT: generated by unitwist Go source code obfuscator.
//
// Use of this source code is governed by the UniDoc End User License Agreement
// terms that can be accessed at https://unidoc.io/eula/

package redactor ;import (_e "errors";_a "fmt";_fb "github.com/unidoc/unipdf/v3/common";_eb "github.com/unidoc/unipdf/v3/contentstream";_fc "github.com/unidoc/unipdf/v3/core";_fba "github.com/unidoc/unipdf/v3/creator";_g "github.com/unidoc/unipdf/v3/extractor";
_b "github.com/unidoc/unipdf/v3/model";_ac "io";_f "regexp";_ff "sort";_ee "strings";);type placeHolders struct{_c []int ;_df string ;_fg float64 ;};func _cc (_dd *_g .TextMarkArray )int {_gf :=0;_gg :=_dd .Elements ();if _gg [0].Text =="\u0020"{_gf ++;
};if _gg [_dd .Len ()-1].Text =="\u0020"{_gf ++;};return _gf ;};func _fdb (_cdge []placeHolders )[]replacement {_efc :=[]replacement {};for _ ,_geagg :=range _cdge {_gacb :=_geagg ._c ;_aee :=_geagg ._df ;_cbe :=_geagg ._fg ;for _ ,_dbb :=range _gacb {_cbd :=replacement {_cg :_aee ,_bf :_cbe ,_aa :_dbb };
_efc =append (_efc ,_cbd );};};_ff .Slice (_efc ,func (_ece ,_gdgb int )bool {return _efc [_ece ]._aa < _efc [_gdgb ]._aa });return _efc ;};func _ddc (_abe *_g .TextMarkArray )(_fc .PdfObject ,int ){var _bff _fc .PdfObject ;_cda :=-1;for _bd ,_bfe :=range _abe .Elements (){_bff =_bfe .DirectObject ;
_cda =_bd ;if _bff !=nil {break ;};};return _bff ,_cda ;};func _aebf (_eaag *matchedIndex ,_bbe [][]int )[]*matchedIndex {_gcae :=[]*matchedIndex {};_dbbd :=_eaag ._fdbb ;_aga :=_dbbd ;_gdfd :=_eaag ._ffe ;_dbd :=0;for _ ,_cad :=range _bbe {_bde :=_cad [0]-_dbbd ;
if _dbd >=_bde {continue ;};_agf :=_gdfd [_dbd :_bde ];_bcf :=&matchedIndex {_ffe :_agf ,_fdbb :_aga ,_ffda :_cad [0]};if len (_ee .TrimSpace (_agf ))!=0{_gcae =append (_gcae ,_bcf );};_dbd =_cad [1]-_dbbd ;_aga =_dbbd +_dbd ;};_afb :=_gdfd [_dbd :];_dfb :=&matchedIndex {_ffe :_afb ,_fdbb :_aga ,_ffda :_eaag ._ffda };
if len (_ee .TrimSpace (_afb ))!=0{_gcae =append (_gcae ,_dfb );};return _gcae ;};type targetMap struct{_fed string ;_dfa [][]int ;};func _cgg (_ebe string )(string ,[][]int ){_dffb :=_f .MustCompile ("\u005c\u006e");_ggdg :=_dffb .FindAllStringIndex (_ebe ,-1);
_eda :=_dffb .ReplaceAllString (_ebe ,"\u0020");return _eda ,_ggdg ;};type matchedIndex struct{_fdbb int ;_ffda int ;_ffe string ;};type localSpanMarks struct{_ceba *_g .TextMarkArray ;_gacc int ;_ggg string ;};func _gdcg (_fa localSpanMarks ,_gaf *_g .TextMarkArray ,_gecg *_b .PdfFont ,_egg ,_ddg string )([]_fc .PdfObject ,error ){_ecf :=_ccee (_gaf );
Tj ,_edg :=_fgb (_gaf );if _edg !=nil {return nil ,_edg ;};_dabc :=len (_egg );_gac :=len (_ecf );_ffa :=-1;_gfb :=_fc .MakeFloat (Tj );if _ecf !=_ddg {_bce :=_fa ._gacc ;if _bce ==0{_ffa =_ee .LastIndex (_egg ,_ecf );}else {_ffa =_ee .Index (_egg ,_ecf );
};}else {_ffa =_ee .Index (_egg ,_ecf );};_ccd :=_ffa +_gac ;_gdfa :=[]_fc .PdfObject {};if _ffa ==0&&_ccd ==_dabc {_gdfa =append (_gdfa ,_gfb );}else if _ffa ==0&&_ccd < _dabc {_gead :=_adb (_egg [_ccd :],_gecg );_afag :=_fc .MakeStringFromBytes (_gead );
_gdfa =append (_gdfa ,_gfb ,_afag );}else if _ffa > 0&&_ccd >=_dabc {_bgb :=_adb (_egg [:_ffa ],_gecg );_dgf :=_fc .MakeStringFromBytes (_bgb );_gdfa =append (_gdfa ,_dgf ,_gfb );}else if _ffa > 0&&_ccd < _dabc {_ddea :=_adb (_egg [:_ffa ],_gecg );_egfa :=_adb (_egg [_ccd :],_gecg );
_dac :=_fc .MakeStringFromBytes (_ddea );_gdfad :=_fc .MakeString (string (_egfa ));_gdfa =append (_gdfa ,_dac ,_gfb ,_gdfad );};return _gdfa ,nil ;};func _ccgd (_aeb *targetMap ,_baa []int ){var _fgg [][]int ;for _ebbb ,_bbg :=range _aeb ._dfa {if _bfdg (_ebbb ,_baa ){continue ;
};_fgg =append (_fgg ,_bbg );};_aeb ._dfa =_fgg ;};func _ccee (_ddcd *_g .TextMarkArray )string {_cbg :="";for _ ,_acg :=range _ddcd .Elements (){_cbg +=_acg .Text ;};return _cbg ;};func _ggc (_edb ,_gfdc string )[]int {if len (_gfdc )==0{return nil ;};
var _fgca []int ;for _gba :=0;_gba < len (_edb );{_gad :=_ee .Index (_edb [_gba :],_gfdc );if _gad < 0{return _fgca ;};_fgca =append (_fgca ,_gba +_gad );_gba +=_gad +len (_gfdc );};return _fgca ;};func _cde (_de []localSpanMarks )(map[string ][]localSpanMarks ,[]string ){_abd :=make (map[string ][]localSpanMarks );
_fca :=[]string {};for _ ,_dfge :=range _de {_bba :=_dfge ._ggg ;if _aac ,_bbad :=_abd [_bba ];_bbad {_abd [_bba ]=append (_aac ,_dfge );}else {_abd [_bba ]=[]localSpanMarks {_dfge };_fca =append (_fca ,_bba );};};return _abd ,_fca ;};

// Redactor represents a Redactor object.
type Redactor struct{_bga *_b .PdfReader ;_gbc *RedactionOptions ;_ffaa *_fba .Creator ;_ffdf *RectangleProps ;};type regexMatcher struct{_bgfa RedactionTerm };func _dga (_cfc []*matchedIndex )[]*targetMap {_bfff :=make (map[string ][][]int );_bgde :=[]*targetMap {};
for _ ,_gdec :=range _cfc {_aacf :=_gdec ._ffe ;_cede :=[]int {_gdec ._fdbb ,_gdec ._ffda };if _bgf ,_bee :=_bfff [_aacf ];_bee {_bfff [_aacf ]=append (_bgf ,_cede );}else {_bfff [_aacf ]=[][]int {_cede };};};for _dfea ,_bed :=range _bfff {_ccf :=&targetMap {_fed :_dfea ,_dfa :_bed };
_bgde =append (_bgde ,_ccf );};return _bgde ;};func _fcc (_af *_eb .ContentStreamOperations ,_db string ,_eec int )error {_dce :=_eb .ContentStreamOperations {};var _dfg _eb .ContentStreamOperation ;for _ebb ,_gd :=range *_af {if _ebb ==_eec {if _db =="\u0027"{_cb :=_eb .ContentStreamOperation {Operand :"\u0054\u002a"};
_dce =append (_dce ,&_cb );_dfg .Params =_gd .Params ;_dfg .Operand ="\u0054\u006a";_dce =append (_dce ,&_dfg );}else if _db =="\u0022"{_ffb :=_gd .Params [:2];Tc ,Tw :=_ffb [0],_ffb [1];_fbe :=_eb .ContentStreamOperation {Params :[]_fc .PdfObject {Tc },Operand :"\u0054\u0063"};
_dce =append (_dce ,&_fbe );_fbe =_eb .ContentStreamOperation {Params :[]_fc .PdfObject {Tw },Operand :"\u0054\u0077"};_dce =append (_dce ,&_fbe );_dfg .Params =[]_fc .PdfObject {_gd .Params [2]};_dfg .Operand ="\u0054\u006a";_dce =append (_dce ,&_dfg );
};};_dce =append (_dce ,_gd );};*_af =_dce ;return nil ;};func _cef (_cea _fc .PdfObject ,_ebf *_b .PdfFont )(string ,error ){_fde ,_fffg :=_fc .GetStringBytes (_cea );if !_fffg {return "",_fc .ErrTypeError ;};_bge :=_ebf .BytesToCharcodes (_fde );_dbag ,_efbc ,_bfb :=_ebf .CharcodesToStrings (_bge ,"");
if _bfb > 0{_fb .Log .Debug ("\u0072\u0065nd\u0065\u0072\u0054e\u0078\u0074\u003a\u0020num\u0043ha\u0072\u0073\u003d\u0025\u0064\u0020\u006eum\u004d\u0069\u0073\u0073\u0065\u0073\u003d%\u0064",_efbc ,_bfb );};_ffdd :=_ee .Join (_dbag ,"");return _ffdd ,nil ;
};func _ce (_fgc *_eb .ContentStreamOperations ,_dc map[_fc .PdfObject ][]localSpanMarks )error {for _eg ,_eea :=range _dc {if _eg ==nil {continue ;};_cd ,_ge ,_ged :=_gfeca (_fgc ,_eg );if !_ged {_fb .Log .Debug ("Pd\u0066\u004fb\u006a\u0065\u0063\u0074\u0020\u0025\u0073\u006e\u006ft\u0020\u0066\u006f\u0075\u006e\u0064\u0020\u0069\u006e\u0020\u0073\u0069\u0064\u0065\u0020\u0074\u0068\u0065\u0020\u0063\u006f\u006e\u0074\u0065\u006e\u0074\u0073\u0074r\u0065a\u006d\u0020\u006f\u0070\u0065\u0072\u0061\u0074i\u006fn\u0020\u0025s",_eg ,_fgc );
return nil ;};if _cd .Operand =="\u0054\u006a"{_fge :=_fdg (_cd ,_eg ,_eea );if _fge !=nil {return _fge ;};}else if _cd .Operand =="\u0054\u004a"{_dcb :=_gea (_cd ,_eg ,_eea );if _dcb !=nil {return _dcb ;};}else if _cd .Operand =="\u0027"||_cd .Operand =="\u0022"{_ab :=_fcc (_fgc ,_cd .Operand ,_ge );
if _ab !=nil {return _ab ;};_ab =_fdg (_cd ,_eg ,_eea );if _ab !=nil {return _ab ;};};};return nil ;};func _adb (_geag string ,_bdba *_b .PdfFont )[]byte {_aae ,_age :=_bdba .StringToCharcodeBytes (_geag );if _age !=0{_fb .Log .Debug ("\u0057\u0041\u0052\u004e\u003a\u0020\u0073\u006fm\u0065\u0020\u0072un\u0065\u0073\u0020\u0063\u006f\u0075l\u0064\u0020\u006e\u006f\u0074\u0020\u0062\u0065\u0020\u0065\u006e\u0063\u006f\u0064\u0065d\u002e\u000a\u0009\u0025\u0073\u0020\u002d\u003e \u0025\u0076",_geag ,_aae );
};return _aae ;};func _ba (_dff string ,_eac []localSpanMarks )([]placeHolders ,error ){_baf :="";_dba :=[]placeHolders {};for _gc ,_cfb :=range _eac {_ecg :=_cfb ._ceba ;_cdg :=_cfb ._ggg ;_deb :=_ccee (_ecg );_bbde ,_afde :=_fgb (_ecg );if _afde !=nil {return nil ,_afde ;
};if _deb !=_baf {var _cgeb []int ;if _gc ==0&&_cdg !=_deb {_fdc :=_ee .Index (_dff ,_deb );_cgeb =[]int {_fdc };}else if _gc ==len (_eac )-1{_bdbd :=_ee .LastIndex (_dff ,_deb );_cgeb =[]int {_bdbd };}else {_cgeb =_ggc (_dff ,_deb );};_eggg :=placeHolders {_c :_cgeb ,_df :_deb ,_fg :_bbde };
_dba =append (_dba ,_eggg );};_baf =_deb ;};return _dba ,nil ;};func _da (_abc *_b .PdfFont ,_gfca _g .TextMark )float64 {_gab :=0.001;_cfg :=_gfca .Th /100;if _abc .Subtype ()=="\u0054\u0079\u0070e\u0033"{_gab =1;};_gfd ,_aed :=_abc .GetRuneMetrics (' ');
if !_aed {_gfd ,_aed =_abc .GetCharMetrics (32);};if !_aed {_gfd ,_ =_b .DefaultFont ().GetRuneMetrics (' ');};_cce :=_gab *((_gfd .Wx *_gfca .FontSize +_gfca .Tc +_gfca .Tw )/_cfg );return _cce ;};func _gea (_cee *_eb .ContentStreamOperation ,_ced _fc .PdfObject ,_dg []localSpanMarks )error {_bdb ,_dgb :=_fc .GetArray (_cee .Params [0]);
_ag :=[]_fc .PdfObject {};if !_dgb {_fb .Log .Debug ("\u0045\u0052\u0052OR\u003a\u0020\u0054\u004a\u0020\u006f\u0070\u003d\u0025s\u0020G\u0065t\u0041r\u0072\u0061\u0079\u0056\u0061\u006c\u0020\u0066\u0061\u0069\u006c\u0065\u0064",_cee );return _a .Errorf ("\u0073\u0070\u0061\u006e\u004d\u0061\u0072\u006bs\u002e\u0042\u0042ox\u0020\u0068\u0061\u0073\u0020\u006eo\u0020\u0062\u006f\u0075\u006e\u0064\u0069\u006e\u0067\u0020\u0062\u006f\u0078\u002e\u0020s\u0070\u0061\u006e\u004d\u0061\u0072\u006b\u0073=\u0025\u0073",_cee );
};_gfc ,_gdd :=_cde (_dg );if len (_gdd )==1{_bg :=_gdd [0];_fd :=_gfc [_bg ];if len (_fd )==1{_bgd :=_fd [0];_gdda :=_bgd ._ceba ;_ad :=_afa (_gdda );_ebg ,_eecg :=_cef (_ced ,_ad );if _eecg !=nil {return _eecg ;};_afc ,_eecg :=_gdcg (_bgd ,_gdda ,_ad ,_ebg ,_bg );
if _eecg !=nil {return _eecg ;};for _ ,_bb :=range _bdb .Elements (){if _bb ==_ced {_ag =append (_ag ,_afc ...);}else {_ag =append (_ag ,_bb );};};}else {_fff :=_fd [0]._ceba ;_ca :=_afa (_fff );_bbd ,_ceb :=_cef (_ced ,_ca );if _ceb !=nil {return _ceb ;
};_ceg ,_ceb :=_ba (_bbd ,_fd );if _ceb !=nil {return _ceb ;};_cba :=_fdb (_ceg );_ea :=_gabd (_bbd ,_cba ,_ca );for _ ,_ae :=range _bdb .Elements (){if _ae ==_ced {_ag =append (_ag ,_ea ...);}else {_ag =append (_ag ,_ae );};};};_cee .Params [0]=_fc .MakeArray (_ag ...);
}else if len (_gdd )> 1{_acf :=_dg [0];_bbf :=_acf ._ceba ;_ ,_eecc :=_ddc (_bbf );_cf :=_bbf .Elements ()[_eecc ];_ed :=_cf .Font ;_gff ,_aba :=_cef (_ced ,_ed );if _aba !=nil {return _aba ;};_ec ,_aba :=_ba (_gff ,_dg );if _aba !=nil {return _aba ;};
_cbb :=_fdb (_ec );_cff :=_gabd (_gff ,_cbb ,_ed );for _ ,_ga :=range _bdb .Elements (){if _ga ==_ced {_ag =append (_ag ,_cff ...);}else {_ag =append (_ag ,_ga );};};_cee .Params [0]=_fc .MakeArray (_ag ...);};return nil ;};

// RedactionTerm holds the regexp pattern and the replacement string for the redaction process.
type RedactionTerm struct{Pattern *_f .Regexp ;};func _eaa (_dgbcd ,_fdcf targetMap )(bool ,[]int ){_fgec :=_ee .Contains (_dgbcd ._fed ,_fdcf ._fed );var _bbc []int ;for _ ,_ebae :=range _dgbcd ._dfa {for _eacd ,_fdf :=range _fdcf ._dfa {if _fdf [0]>=_ebae [0]&&_fdf [1]<=_ebae [1]{_bbc =append (_bbc ,_eacd );
};};};return _fgec ,_bbc ;};func _cdef (_fe ,_gbg ,_abee float64 )float64 {_abee =_abee /100;_ffbb :=(-1000*_fe )/(_gbg *_abee );return _ffbb ;};func _bfdg (_fcab int ,_gfbe []int )bool {for _ ,_geae :=range _gfbe {if _geae ==_fcab {return true ;};};return false ;
};func _gca (_cgf []int ,_dbg *_g .TextMarkArray ,_acd string )(*_g .TextMarkArray ,matchedBBox ,error ){_bcg :=matchedBBox {};_gcfd :=_cgf [0];_gcd :=_cgf [1];_feb :=len (_acd )-len (_ee .TrimLeft (_acd ,"\u0020"));_ggd :=len (_acd )-len (_ee .TrimRight (_acd ,"\u0020\u000a"));
_gcfd =_gcfd +_feb ;_gcd =_gcd -_ggd ;_acd =_ee .Trim (_acd ,"\u0020\u000a");_feg ,_febf :=_dbg .RangeOffset (_gcfd ,_gcd );if _febf !=nil {return nil ,_bcg ,_febf ;};_fcaa ,_dccc :=_feg .BBox ();if !_dccc {return nil ,_bcg ,_a .Errorf ("\u0073\u0070\u0061\u006e\u004d\u0061\u0072\u006bs\u002e\u0042\u0042ox\u0020\u0068\u0061\u0073\u0020\u006eo\u0020\u0062\u006f\u0075\u006e\u0064\u0069\u006e\u0067\u0020\u0062\u006f\u0078\u002e\u0020s\u0070\u0061\u006e\u004d\u0061\u0072\u006b\u0073=\u0025\u0073",_feg );
};_bcg =matchedBBox {_fbag :_acd ,_gcf :_fcaa };return _feg ,_bcg ,nil ;};func _gfeca (_efb *_eb .ContentStreamOperations ,PdfObj _fc .PdfObject )(*_eb .ContentStreamOperation ,int ,bool ){for _gaa ,_fafe :=range *_efb {_edc :=_fafe .Operand ;if _edc =="\u0054\u006a"{_ccdd :=_fc .TraceToDirectObject (_fafe .Params [0]);
if _ccdd ==PdfObj {return _fafe ,_gaa ,true ;};}else if _edc =="\u0054\u004a"{_efg ,_aeg :=_fc .GetArray (_fafe .Params [0]);if !_aeg {return nil ,_gaa ,_aeg ;};for _ ,_cdc :=range _efg .Elements (){if _cdc ==PdfObj {return _fafe ,_gaa ,true ;};};}else if _edc =="\u0022"{_cfbg :=_fc .TraceToDirectObject (_fafe .Params [2]);
if _cfbg ==PdfObj {return _fafe ,_gaa ,true ;};}else if _edc =="\u0027"{_ddcb :=_fc .TraceToDirectObject (_fafe .Params [0]);if _ddcb ==PdfObj {return _fafe ,_gaa ,true ;};};};return nil ,-1,false ;};

// New instantiates a Redactor object with given PdfReader and `regex` pattern.
func New (reader *_b .PdfReader ,opts *RedactionOptions ,rectProps *RectangleProps )*Redactor {if rectProps ==nil {rectProps =RedactRectanglePropsNew ();};return &Redactor {_bga :reader ,_gbc :opts ,_ffaa :_fba .New (),_ffdf :rectProps };};func _cceb (_ffdac *_g .TextMarkArray )[]*_g .TextMarkArray {_cfa :=_ffdac .Elements ();
_ebab :=len (_cfa );var _bbca _fc .PdfObject ;_gaaa :=[]*_g .TextMarkArray {};_egabf :=&_g .TextMarkArray {};_dcd :=-1;for _dbgd ,_fdd :=range _cfa {_bfg :=_fdd .DirectObject ;_dcd =_fdd .Index ;if _bfg ==nil {_gagf :=_gedf (_ffdac ,_dbgd ,_dcd );if _bbca !=nil {if _gagf ==-1||_gagf > _dbgd {_gaaa =append (_gaaa ,_egabf );
_egabf =&_g .TextMarkArray {};};};}else if _bfg !=nil &&_bbca ==nil {if _dcd ==0&&_dbgd > 0{_gaaa =append (_gaaa ,_egabf );_egabf =&_g .TextMarkArray {};};}else if _bfg !=nil &&_bbca !=nil {if _bfg !=_bbca {_gaaa =append (_gaaa ,_egabf );_egabf =&_g .TextMarkArray {};
};};_bbca =_bfg ;_egabf .Append (_fdd );if _dbgd ==(_ebab -1){_gaaa =append (_gaaa ,_egabf );};};return _gaaa ;};

// RedactionOptions is a collection of RedactionTerm objects.
type RedactionOptions struct{Terms []RedactionTerm ;};func _cadb (_aebe *matchedIndex ,_gagfb [][]int )(bool ,[][]int ){_gebg :=[][]int {};for _ ,_ccae :=range _gagfb {if _aebe ._fdbb < _ccae [0]&&_aebe ._ffda > _ccae [1]{_gebg =append (_gebg ,_ccae );
};};return len (_gebg )> 0,_gebg ;};func _ggda (_fffbg []*matchedIndex ,_beb [][]int )[]*matchedIndex {_efab :=[]*matchedIndex {};for _ ,_fegf :=range _fffbg {_cfe ,_fcad :=_cadb (_fegf ,_beb );if _cfe {_bbfd :=_aebf (_fegf ,_fcad );_efab =append (_efab ,_bbfd ...);
}else {_efab =append (_efab ,_fegf );};};return _efab ;};

// WriteToFile writes the redacted document to file specified by `outputPath`.
func (_gbgf *Redactor )WriteToFile (outputPath string )error {if _fef :=_gbgf ._ffaa .WriteToFile (outputPath );_fef !=nil {return _a .Errorf ("\u0066\u0061\u0069l\u0065\u0064\u0020\u0074o\u0020\u0077\u0072\u0069\u0074\u0065\u0020t\u0068\u0065\u0020\u006f\u0075\u0074\u0070\u0075\u0074\u0020\u0066\u0069\u006c\u0065");
};return nil ;};func (_cgeg *Redactor )redactPage (_faa *_eb .ContentStreamOperations ,_bec *_b .PdfPageResources )([]matchedBBox ,*_eb .ContentStreamOperations ,error ){_gbaf ,_gggf :=_g .NewFromContents (_faa .String (),_bec );if _gggf !=nil {return nil ,nil ,_gggf ;
};_dbc ,_ ,_ ,_gggf :=_gbaf .ExtractPageText ();if _gggf !=nil {return nil ,nil ,_gggf ;};_faa =_dbc .GetContentStreamOps ();_dgbf :=_dbc .Marks ();_gaaf :=_dbc .Text ();_gaaf ,_dcbe :=_cgg (_gaaf );_aad :=[]matchedBBox {};_efba :=make (map[_fc .PdfObject ][]localSpanMarks );
_gcgf :=[]*targetMap {};for _ ,_eaga :=range _cgeg ._gbc .Terms {_gdb ,_ffbe :=_geg (_eaga );if _ffbe !=nil {return nil ,nil ,_ffbe ;};_gde ,_ffbe :=_gdb .match (_gaaf );if _ffbe !=nil {return nil ,nil ,_ffbe ;};_gde =_ggda (_gde ,_dcbe );_gfba :=_dga (_gde );
_gcgf =append (_gcgf ,_gfba ...);};_bag (_gcgf );for _ ,_fcb :=range _gcgf {_ada :=_fcb ._fed ;_dea :=_fcb ._dfa ;_eabd :=[]matchedBBox {};for _ ,_ddef :=range _dea {_cddc ,_ade ,_dae :=_gca (_ddef ,_dgbf ,_ada );if _dae !=nil {return nil ,nil ,_dae ;};
_cfgg :=_cceb (_cddc );for _cgb ,_afae :=range _cfgg {_gge :=localSpanMarks {_ceba :_afae ,_gacc :_cgb ,_ggg :_ada };_eef ,_ :=_ddc (_afae );if _gfbb ,_ebd :=_efba [_eef ];_ebd {_efba [_eef ]=append (_gfbb ,_gge );}else {_efba [_eef ]=[]localSpanMarks {_gge };
};};_eabd =append (_eabd ,_ade );};_aad =append (_aad ,_eabd ...);};_gggf =_ce (_faa ,_efba );if _gggf !=nil {return nil ,nil ,_gggf ;};return _aad ,_faa ,nil ;};func _geg (_cfbd RedactionTerm )(*regexMatcher ,error ){return &regexMatcher {_bgfa :_cfbd },nil };
func _fgb (_dgbb *_g .TextMarkArray )(float64 ,error ){_efa ,_gdgd :=_dgbb .BBox ();if !_gdgd {return 0.0,_a .Errorf ("\u0073\u0070\u0061\u006e\u004d\u0061\u0072\u006bs\u002e\u0042\u0042ox\u0020\u0068\u0061\u0073\u0020\u006eo\u0020\u0062\u006f\u0075\u006e\u0064\u0069\u006e\u0067\u0020\u0062\u006f\u0078\u002e\u0020s\u0070\u0061\u006e\u004d\u0061\u0072\u006b\u0073=\u0025\u0073",_dgbb );
};_abeb :=_cc (_dgbb );_agbg :=0.0;_ ,_fffb :=_ddc (_dgbb );_acc :=_dgbb .Elements ()[_fffb ];_fac :=_acc .Font ;if _abeb > 0{_agbg =_da (_fac ,_acc );};_dcg :=(_efa .Urx -_efa .Llx );_dcg =_dcg +_agbg *float64 (_abeb );Tj :=_cdef (_dcg ,_acc .FontSize ,_acc .Th );
return Tj ,nil ;};func _bag (_bfda []*targetMap ){for _eece ,_bad :=range _bfda {for _aab ,_ccg :=range _bfda {if _eece !=_aab {_gfa ,_gdfaa :=_eaa (*_bad ,*_ccg );if _gfa {_ccgd (_ccg ,_gdfaa );};};};};};

// Redact executes the redact operation on a pdf file and updates the content streams of all pages of the file.
func (_gcg *Redactor )Redact ()error {_ecc ,_bef :=_gcg ._bga .GetNumPages ();if _bef !=nil {return _a .Errorf ("\u0066\u0061\u0069\u006c\u0065\u0064 \u0074\u006f\u0020\u0067\u0065\u0074\u0020\u0074\u0068\u0065\u0020\u006e\u0075m\u0062\u0065\u0072\u0020\u006f\u0066\u0020P\u0061\u0067\u0065\u0073");
};_gag :=_gcg ._ffdf .FillColor ;_bgea :=_gcg ._ffdf .BorderWidth ;_eaea :=_gcg ._ffdf .FillOpacity ;for _dda :=1;_dda <=_ecc ;_dda ++{_eccg ,_gfed :=_gcg ._bga .GetPage (_dda );if _gfed !=nil {return _gfed ;};_dec ,_gfed :=_g .New (_eccg );if _gfed !=nil {return _gfed ;
};_ffc ,_ ,_ ,_gfed :=_dec .ExtractPageText ();if _gfed !=nil {return _gfed ;};_cbeb :=_ffc .GetContentStreamOps ();_gbga ,_decf ,_gfed :=_gcg .redactPage (_cbeb ,_eccg .Resources );if _decf ==nil {_fb .Log .Info ("N\u006f\u0020\u006d\u0061\u0074\u0063\u0068\u0020\u0066\u006f\u0075\u006e\u0064\u0020\u0066\u006f\u0072\u0020t\u0068\u0065\u0020\u0070\u0072\u006f\u0076\u0069\u0064\u0065d \u0070\u0061\u0074t\u0061r\u006e\u002e");
_decf =_cbeb ;};_cegde :=_eb .ContentStreamOperation {Operand :"\u006e"};*_decf =append (*_decf ,&_cegde );_eccg .SetContentStreams ([]string {_decf .String ()},_fc .NewFlateEncoder ());if _gfed !=nil {return _gfed ;};_ecea ,_gfed :=_eccg .GetMediaBox ();
if _gfed !=nil {return _gfed ;};if _eccg .MediaBox ==nil {_eccg .MediaBox =_ecea ;};if _gebf :=_gcg ._ffaa .AddPage (_eccg );_gebf !=nil {return _gebf ;};_ff .Slice (_gbga ,func (_adba ,_dacg int )bool {return _gbga [_adba ]._fbag < _gbga [_dacg ]._fbag });
_aedd :=_ecea .Ury ;for _ ,_gbb :=range _gbga {_gacbe :=_gbb ._gcf ;_bfd :=_gcg ._ffaa .NewRectangle (_gacbe .Llx ,_aedd -_gacbe .Lly ,_gacbe .Urx -_gacbe .Llx ,-(_gacbe .Ury -_gacbe .Lly ));_bfd .SetFillColor (_gag );_bfd .SetBorderWidth (_bgea );_bfd .SetFillOpacity (_eaea );
if _cac :=_gcg ._ffaa .Draw (_bfd );_cac !=nil {return nil ;};};};_gcg ._ffaa .SetOutlineTree (_gcg ._bga .GetOutlineTree ());return nil ;};func _gedf (_fbc *_g .TextMarkArray ,_ffag int ,_aefd int )int {_bcb :=_fbc .Elements ();_eff :=_ffag -1;_gffg :=_ffag +1;
_fea :=-1;if _eff >=0{_gdbf :=_bcb [_eff ];_adbf :=_gdbf .ObjString ;_ddgg :=len (_adbf );_eecb :=_gdbf .Index ;if _eecb +1< _ddgg {_fea =_eff ;return _fea ;};};if _gffg < len (_bcb ){_ccab :=_bcb [_gffg ];_effe :=_ccab .ObjString ;if _effe [0]!=_ccab .Text {_fea =_gffg ;
return _fea ;};};return _fea ;};func _afa (_ef *_g .TextMarkArray )*_b .PdfFont {_ ,_ggf :=_ddc (_ef );_bgg :=_ef .Elements ()[_ggf ];_cdd :=_bgg .Font ;return _cdd ;};func _gabd (_cca string ,_cfd []replacement ,_bbaf *_b .PdfFont )[]_fc .PdfObject {_fbea :=[]_fc .PdfObject {};
_eag :=0;_faf :=_cca ;for _bdbc ,_fbf :=range _cfd {_dded :=_fbf ._aa ;_gfec :=_fbf ._bf ;_ebcc :=_fbf ._cg ;_bfee :=_fc .MakeFloat (_gfec );if _eag > _dded ||_dded ==-1{continue ;};_fdgb :=_cca [_eag :_dded ];_dccb :=_adb (_fdgb ,_bbaf );_gdfe :=_fc .MakeStringFromBytes (_dccb );
_fbea =append (_fbea ,_gdfe );_fbea =append (_fbea ,_bfee );_cbad :=_dded +len (_ebcc );_faf =_cca [_cbad :];_eag =_cbad ;if _bdbc ==len (_cfd )-1{_dccb =_adb (_faf ,_bbaf );_gdfe =_fc .MakeStringFromBytes (_dccb );_fbea =append (_fbea ,_gdfe );};};return _fbea ;
};func _fdg (_egf *_eb .ContentStreamOperation ,_gdc _fc .PdfObject ,_ffd []localSpanMarks )error {var _dgbc *_fc .PdfObjectArray ;_gb ,_eba :=_cde (_ffd );if len (_eba )==1{_bdf :=_eba [0];_dab :=_gb [_bdf ];if len (_dab )==1{_be :=_dab [0];_eca :=_be ._ceba ;
_agb :=_afa (_eca );_adg ,_ede :=_cef (_gdc ,_agb );if _ede !=nil {return _ede ;};_gdf ,_ede :=_gdcg (_be ,_eca ,_agb ,_adg ,_bdf );if _ede !=nil {return _ede ;};_dgbc =_fc .MakeArray (_gdf ...);}else {_afd :=_dab [0]._ceba ;_cge :=_afa (_afd );_eae ,_bbac :=_cef (_gdc ,_cge );
if _bbac !=nil {return _bbac ;};_geb ,_bbac :=_ba (_eae ,_dab );if _bbac !=nil {return _bbac ;};_fgcg :=_fdb (_geb );_dde :=_gabd (_eae ,_fgcg ,_cge );_dgbc =_fc .MakeArray (_dde ...);};}else if len (_eba )> 1{_aef :=_ffd [0];_ecaf :=_aef ._ceba ;_ ,_dfe :=_ddc (_ecaf );
_daf :=_ecaf .Elements ()[_dfe ];_gfe :=_daf .Font ;_gdg ,_fce :=_cef (_gdc ,_gfe );if _fce !=nil {return _fce ;};_cddb ,_fce :=_ba (_gdg ,_ffd );if _fce !=nil {return _fce ;};_dgbg :=_fdb (_cddb );_bc :=_gabd (_gdg ,_dgbg ,_gfe );_dgbc =_fc .MakeArray (_bc ...);
};_egf .Params [0]=_dgbc ;_egf .Operand ="\u0054\u004a";return nil ;};

// RectangleProps defines properties of the redaction rectangle to be drawn.
type RectangleProps struct{FillColor _fba .Color ;BorderWidth float64 ;FillOpacity float64 ;};type replacement struct{_cg string ;_bf float64 ;_aa int ;};func (_ead *regexMatcher )match (_ceee string )([]*matchedIndex ,error ){_gef :=_ead ._bgfa .Pattern ;
if _gef ==nil {return nil ,_e .New ("\u006e\u006f\u0020\u0070at\u0074\u0065\u0072\u006e\u0020\u0063\u006f\u006d\u0070\u0069\u006c\u0065\u0064");};var (_aefb =_gef .FindAllStringIndex (_ceee ,-1);_decg []*matchedIndex ;);for _ ,_ggdf :=range _aefb {_decg =append (_decg ,&matchedIndex {_fdbb :_ggdf [0],_ffda :_ggdf [1],_ffe :_ceee [_ggdf [0]:_ggdf [1]]});
};return _decg ,nil ;};

// RedactRectanglePropsNew return a new pointer to a default RectangleProps object.
func RedactRectanglePropsNew ()*RectangleProps {return &RectangleProps {FillColor :_fba .ColorBlack ,BorderWidth :0.0,FillOpacity :1.0};};

// Write writes the content of `re.creator` to writer of type io.Writer interface.
func (_ecgf *Redactor )Write (writer _ac .Writer )error {return _ecgf ._ffaa .Write (writer )};type matchedBBox struct{_gcf _b .PdfRectangle ;_fbag string ;};
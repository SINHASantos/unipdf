//
// Copyright 2020 FoxyUtils ehf. All rights reserved.
//
// This is a commercial product and requires a license to operate.
// A trial license can be obtained at https://unidoc.io
//
// DO NOT EDIT: generated by unitwist Go source code obfuscator.
//
// Use of this source code is governed by the UniDoc End User License Agreement
// terms that can be accessed at https://unidoc.io/eula/

package redactor ;import (_db "errors";_b "fmt";_a "github.com/unidoc/unipdf/v3/common";_cg "github.com/unidoc/unipdf/v3/contentstream";_ce "github.com/unidoc/unipdf/v3/core";_cc "github.com/unidoc/unipdf/v3/creator";_ba "github.com/unidoc/unipdf/v3/extractor";
_g "github.com/unidoc/unipdf/v3/model";_c "io";_de "regexp";_f "sort";_cd "strings";);func _bcce (_afa *matchedIndex ,_abb [][]int )(bool ,[][]int ){_gdf :=[][]int {};for _ ,_cdfg :=range _abb {if _afa ._fcbf < _cdfg [0]&&_afa ._bcfa > _cdfg [1]{_gdf =append (_gdf ,_cdfg );
};};return len (_gdf )> 0,_gdf ;};func _edg (_edgc _ce .PdfObject ,_aeda *_g .PdfFont )(string ,error ){_cfa ,_cba :=_ce .GetStringBytes (_edgc );if !_cba {return "",_ce .ErrTypeError ;};_bdcc :=_aeda .BytesToCharcodes (_cfa );_ggea ,_bag ,_ebf :=_aeda .CharcodesToStrings (_bdcc ,"");
if _ebf > 0{_a .Log .Debug ("\u0072\u0065nd\u0065\u0072\u0054e\u0078\u0074\u003a\u0020num\u0043ha\u0072\u0073\u003d\u0025\u0064\u0020\u006eum\u004d\u0069\u0073\u0073\u0065\u0073\u003d%\u0064",_bag ,_ebf );};_fgab :=_cd .Join (_ggea ,"");return _fgab ,nil ;
};func _fcga (_bd *_cg .ContentStreamOperation ,_cdg _ce .PdfObject ,_ced []localSpanMarks )error {_bba ,_gac :=_ce .GetArray (_bd .Params [0]);_gaa :=[]_ce .PdfObject {};if !_gac {_a .Log .Debug ("\u0045\u0052\u0052OR\u003a\u0020\u0054\u004a\u0020\u006f\u0070\u003d\u0025s\u0020G\u0065t\u0041r\u0072\u0061\u0079\u0056\u0061\u006c\u0020\u0066\u0061\u0069\u006c\u0065\u0064",_bd );
return _b .Errorf ("\u0073\u0070\u0061\u006e\u004d\u0061\u0072\u006bs\u002e\u0042\u0042ox\u0020\u0068\u0061\u0073\u0020\u006eo\u0020\u0062\u006f\u0075\u006e\u0064\u0069\u006e\u0067\u0020\u0062\u006f\u0078\u002e\u0020s\u0070\u0061\u006e\u004d\u0061\u0072\u006b\u0073=\u0025\u0073",_bd );
};_gfd ,_fab :=_ca (_ced );if len (_fab )==1{_fcb :=_fab [0];_fcbd :=_gfd [_fcb ];if len (_fcbd )==1{_aeb :=_fcbd [0];_dgf :=_aeb ._daff ;_bde :=_gbd (_dgf );_ab ,_cda :=_edg (_cdg ,_bde );if _cda !=nil {return _cda ;};_ec ,_cda :=_cecc (_aeb ,_dgf ,_bde ,_ab ,_fcb );
if _cda !=nil {return _cda ;};for _ ,_bfg :=range _bba .Elements (){if _bfg ==_cdg {_gaa =append (_gaa ,_ec ...);}else {_gaa =append (_gaa ,_bfg );};};}else {_af :=_fcbd [0]._daff ;_fe :=_gbd (_af );_ge ,_ccd :=_edg (_cdg ,_fe );if _ccd !=nil {return _ccd ;
};_ecf ,_ccd :=_gfe (_ge ,_fcbd );if _ccd !=nil {return _ccd ;};_bab :=_ceeg (_ecf );_aaf :=_gfcd (_ge ,_bab ,_fe );for _ ,_bbd :=range _bba .Elements (){if _bbd ==_cdg {_gaa =append (_gaa ,_aaf ...);}else {_gaa =append (_gaa ,_bbd );};};};_bd .Params [0]=_ce .MakeArray (_gaa ...);
}else if len (_fab )> 1{_fcfc :=_ced [0];_ea :=_fcfc ._daff ;_ ,_cggd :=_cgg (_ea );_be :=_ea .Elements ()[_cggd ];_bbe :=_be .Font ;_cgc ,_gbg :=_edg (_cdg ,_bbe );if _gbg !=nil {return _gbg ;};_aafe ,_gbg :=_gfe (_cgc ,_ced );if _gbg !=nil {return _gbg ;
};_acd :=_ceeg (_aafe );_gaaa :=_gfcd (_cgc ,_acd ,_bbe );for _ ,_gff :=range _bba .Elements (){if _gff ==_cdg {_gaa =append (_gaa ,_gaaa ...);}else {_gaa =append (_gaa ,_gff );};};_bd .Params [0]=_ce .MakeArray (_gaa ...);};return nil ;};func _bbg (_abcb ,_gcc string )[]int {if len (_gcc )==0{return nil ;
};var _bca []int ;for _ggb :=0;_ggb < len (_abcb );{_fef :=_cd .Index (_abcb [_ggb :],_gcc );if _fef < 0{return _bca ;};_bca =append (_bca ,_ggb +_fef );_ggb +=_fef +len (_gcc );};return _bca ;};func _ceeg (_dbg []placeHolders )[]replacement {_cbc :=[]replacement {};
for _ ,_fgb :=range _dbg {_aaa :=_fgb ._fd ;_fgef :=_fgb ._bg ;_ead :=_fgb ._bb ;for _ ,_cfg :=range _aaa {_fedf :=replacement {_baf :_fgef ,_fc :_ead ,_fg :_cfg };_cbc =append (_cbc ,_fedf );};};_f .Slice (_cbc ,func (_bgc ,_bga int )bool {return _cbc [_bgc ]._fg < _cbc [_bga ]._fg });
return _cbc ;};func _gge (_gfc *_cg .ContentStreamOperations ,_fb string ,_adc int )error {_ac :=_cg .ContentStreamOperations {};var _acf _cg .ContentStreamOperation ;for _fcg ,_ffc :=range *_gfc {if _fcg ==_adc {if _fb =="\u0027"{_aa :=_cg .ContentStreamOperation {Operand :"\u0054\u002a"};
_ac =append (_ac ,&_aa );_acf .Params =_ffc .Params ;_acf .Operand ="\u0054\u006a";_ac =append (_ac ,&_acf );}else if _fb =="\u0022"{_gaf :=_ffc .Params [:2];Tc ,Tw :=_gaf [0],_gaf [1];_gb :=_cg .ContentStreamOperation {Params :[]_ce .PdfObject {Tc },Operand :"\u0054\u0063"};
_ac =append (_ac ,&_gb );_gb =_cg .ContentStreamOperation {Params :[]_ce .PdfObject {Tw },Operand :"\u0054\u0077"};_ac =append (_ac ,&_gb );_acf .Params =[]_ce .PdfObject {_ffc .Params [2]};_acf .Operand ="\u0054\u006a";_ac =append (_ac ,&_acf );};};_ac =append (_ac ,_ffc );
};*_gfc =_ac ;return nil ;};type targetMap struct{_cbca string ;_bgb [][]int ;};func _dde (_affc string )(string ,[][]int ){_deeg :=_de .MustCompile ("\u005c\u006e");_aegf :=_deeg .FindAllStringIndex (_affc ,-1);_gadc :=_deeg .ReplaceAllString (_affc ,"\u0020");
return _gadc ,_aegf ;};

// Redact executes the redact operation on a pdf file and updates the content streams of all pages of the file.
func (_deb *Redactor )Redact ()error {_aace ,_abgf :=_deb ._fdd .GetNumPages ();if _abgf !=nil {return _b .Errorf ("\u0066\u0061\u0069\u006c\u0065\u0064 \u0074\u006f\u0020\u0067\u0065\u0074\u0020\u0074\u0068\u0065\u0020\u006e\u0075m\u0062\u0065\u0072\u0020\u006f\u0066\u0020P\u0061\u0067\u0065\u0073");
};_dag :=_deb ._bge .FillColor ;_ddg :=_deb ._bge .BorderWidth ;_gec :=_deb ._bge .FillOpacity ;for _df :=1;_df <=_aace ;_df ++{_bafga ,_ggcc :=_deb ._fdd .GetPage (_df );if _ggcc !=nil {return _ggcc ;};_fcd ,_ggcc :=_ba .New (_bafga );if _ggcc !=nil {return _ggcc ;
};_gaea ,_ ,_ ,_ggcc :=_fcd .ExtractPageText ();if _ggcc !=nil {return _ggcc ;};_eea :=_gaea .GetContentStreamOps ();_ccb ,_fbad ,_ggcc :=_deb .redactPage (_eea ,_bafga .Resources );if _fbad ==nil {_a .Log .Info ("N\u006f\u0020\u006d\u0061\u0074\u0063\u0068\u0020\u0066\u006f\u0075\u006e\u0064\u0020\u0066\u006f\u0072\u0020t\u0068\u0065\u0020\u0070\u0072\u006f\u0076\u0069\u0064\u0065d \u0070\u0061\u0074t\u0061r\u006e\u002e");
_fbad =_eea ;};_bfdb :=_cg .ContentStreamOperation {Operand :"\u006e"};*_fbad =append (*_fbad ,&_bfdb );_bafga .SetContentStreams ([]string {_fbad .String ()},_ce .NewFlateEncoder ());if _ggcc !=nil {return _ggcc ;};_aba ,_ggcc :=_bafga .GetMediaBox ();
if _ggcc !=nil {return _ggcc ;};if _bafga .MediaBox ==nil {_bafga .MediaBox =_aba ;};if _adda :=_deb ._ecc .AddPage (_bafga );_adda !=nil {return _adda ;};_f .Slice (_ccb ,func (_ece ,_aea int )bool {return _ccb [_ece ]._daf < _ccb [_aea ]._daf });_cea :=_aba .Ury ;
for _ ,_ebbf :=range _ccb {_dgde :=_ebbf ._ggcd ;_deed :=_deb ._ecc .NewRectangle (_dgde .Llx ,_cea -_dgde .Lly ,_dgde .Urx -_dgde .Llx ,-(_dgde .Ury -_dgde .Lly ));_deed .SetFillColor (_dag );_deed .SetBorderWidth (_ddg );_deed .SetFillOpacity (_gec );
if _ffa :=_deb ._ecc .Draw (_deed );_ffa !=nil {return nil ;};};};_deb ._ecc .SetOutlineTree (_deb ._fdd .GetOutlineTree ());return nil ;};func _bdc (_bfd *_cg .ContentStreamOperation ,_bdd _ce .PdfObject ,_gc []localSpanMarks )error {var _bee *_ce .PdfObjectArray ;
_eca ,_ee :=_ca (_gc );if len (_ee )==1{_eab :=_ee [0];_cec :=_eca [_eab ];if len (_cec )==1{_eeg :=_cec [0];_bad :=_eeg ._daff ;_aca :=_gbd (_bad );_gfbf ,_aee :=_edg (_bdd ,_aca );if _aee !=nil {return _aee ;};_acg ,_aee :=_cecc (_eeg ,_bad ,_aca ,_gfbf ,_eab );
if _aee !=nil {return _aee ;};_bee =_ce .MakeArray (_acg ...);}else {_cce :=_cec [0]._daff ;_eda :=_gbd (_cce );_ebg ,_ecb :=_edg (_bdd ,_eda );if _ecb !=nil {return _ecb ;};_bbef ,_ecb :=_gfe (_ebg ,_cec );if _ecb !=nil {return _ecb ;};_aag :=_ceeg (_bbef );
_dd :=_gfcd (_ebg ,_aag ,_eda );_bee =_ce .MakeArray (_dd ...);};}else if len (_ee )> 1{_fea :=_gc [0];_cf :=_fea ._daff ;_ ,_egd :=_cgg (_cf );_ebb :=_cf .Elements ()[_egd ];_eba :=_ebb .Font ;_eabb ,_abd :=_edg (_bdd ,_eba );if _abd !=nil {return _abd ;
};_bae ,_abd :=_gfe (_eabb ,_gc );if _abd !=nil {return _abd ;};_caf :=_ceeg (_bae );_cge :=_gfcd (_eabb ,_caf ,_eba );_bee =_ce .MakeArray (_cge ...);};_bfd .Params [0]=_bee ;_bfd .Operand ="\u0054\u004a";return nil ;};func _cgf (_cddg []*matchedIndex )[]*targetMap {_cgfg :=make (map[string ][][]int );
_aade :=[]*targetMap {};for _ ,_bcg :=range _cddg {_agb :=_bcg ._bdece ;_gefg :=[]int {_bcg ._fcbf ,_bcg ._bcfa };if _gbc ,_aeac :=_cgfg [_agb ];_aeac {_cgfg [_agb ]=append (_gbc ,_gefg );}else {_cgfg [_agb ]=[][]int {_gefg };};};for _cccf ,_debb :=range _cgfg {_dac :=&targetMap {_cbca :_cccf ,_bgb :_debb };
_aade =append (_aade ,_dac );};return _aade ;};

// RedactionTerm holds the regexp pattern and the replacement string for the redaction process.
type RedactionTerm struct{Pattern *_de .Regexp ;};func _gcb (_cdb int ,_bfc []int )bool {for _ ,_fbdg :=range _bfc {if _fbdg ==_cdb {return true ;};};return false ;};func _gfe (_dgb string ,_geg []localSpanMarks )([]placeHolders ,error ){_abg :="";_fag :=[]placeHolders {};
for _bbcb ,_ggg :=range _geg {_gaff :=_ggg ._daff ;_dee :=_ggg ._badd ;_gaac :=_fee (_gaff );_aafeb ,_egfd :=_ebd (_gaff );if _egfd !=nil {return nil ,_egfd ;};if _gaac !=_abg {var _aed []int ;if _bbcb ==0&&_dee !=_gaac {_dgd :=_cd .Index (_dgb ,_gaac );
_aed =[]int {_dgd };}else if _bbcb ==len (_geg )-1{_edb :=_cd .LastIndex (_dgb ,_gaac );_aed =[]int {_edb };}else {_aed =_bbg (_dgb ,_gaac );};_ddag :=placeHolders {_fd :_aed ,_bg :_gaac ,_bb :_aafeb };_fag =append (_fag ,_ddag );};_abg =_gaac ;};return _fag ,nil ;
};func _acfc (_ged *_g .PdfFont ,_fgg _ba .TextMark )float64 {_dec :=0.001;_add :=_fgg .Th /100;if _ged .Subtype ()=="\u0054\u0079\u0070e\u0033"{_dec =1;};_eae ,_gga :=_ged .GetRuneMetrics (' ');if !_gga {_eae ,_gga =_ged .GetCharMetrics (32);};if !_gga {_eae ,_ =_g .DefaultFont ().GetRuneMetrics (' ');
};_egf :=_dec *((_eae .Wx *_fgg .FontSize +_fgg .Tc +_fgg .Tw )/_add );return _egf ;};func _cbb (_aacc *_cg .ContentStreamOperations ,PdfObj _ce .PdfObject )(*_cg .ContentStreamOperation ,int ,bool ){for _ccf ,_eagc :=range *_aacc {_dbf :=_eagc .Operand ;
if _dbf =="\u0054\u006a"{_fba :=_ce .TraceToDirectObject (_eagc .Params [0]);if _fba ==PdfObj {return _eagc ,_ccf ,true ;};}else if _dbf =="\u0054\u004a"{_cdde ,_aeg :=_ce .GetArray (_eagc .Params [0]);if !_aeg {return nil ,_ccf ,_aeg ;};for _ ,_eee :=range _cdde .Elements (){if _eee ==PdfObj {return _eagc ,_ccf ,true ;
};};}else if _dbf =="\u0022"{_acgb :=_ce .TraceToDirectObject (_eagc .Params [2]);if _acgb ==PdfObj {return _eagc ,_ccf ,true ;};}else if _dbf =="\u0027"{_gfba :=_ce .TraceToDirectObject (_eagc .Params [0]);if _gfba ==PdfObj {return _eagc ,_ccf ,true ;
};};};return nil ,-1,false ;};

// RedactRectanglePropsNew return a new pointer to a default RectangleProps object.
func RedactRectanglePropsNew ()*RectangleProps {return &RectangleProps {FillColor :_cc .ColorBlack ,BorderWidth :0.0,FillOpacity :1.0};};func _ga (_gf *_cg .ContentStreamOperations ,_gg map[_ce .PdfObject ][]localSpanMarks )error {for _e ,_ff :=range _gg {if _e ==nil {continue ;
};_bgf ,_bc ,_fge :=_cbb (_gf ,_e );if !_fge {_a .Log .Debug ("Pd\u0066\u004fb\u006a\u0065\u0063\u0074\u0020\u0025\u0073\u006e\u006ft\u0020\u0066\u006f\u0075\u006e\u0064\u0020\u0069\u006e\u0020\u0073\u0069\u0064\u0065\u0020\u0074\u0068\u0065\u0020\u0063\u006f\u006e\u0074\u0065\u006e\u0074\u0073\u0074r\u0065a\u006d\u0020\u006f\u0070\u0065\u0072\u0061\u0074i\u006fn\u0020\u0025s",_e ,_gf );
return nil ;};if _bgf .Operand =="\u0054\u006a"{_bgg :=_bdc (_bgf ,_e ,_ff );if _bgg !=nil {return _bgg ;};}else if _bgf .Operand =="\u0054\u004a"{_ad :=_fcga (_bgf ,_e ,_ff );if _ad !=nil {return _ad ;};}else if _bgf .Operand =="\u0027"||_bgf .Operand =="\u0022"{_fa :=_gge (_gf ,_bgf .Operand ,_bc );
if _fa !=nil {return _fa ;};_fa =_bdc (_bgf ,_e ,_ff );if _fa !=nil {return _fa ;};};};return nil ;};type replacement struct{_baf string ;_fc float64 ;_fg int ;};type matchedBBox struct{_ggcd _g .PdfRectangle ;_daf string ;};func _ffg (_cbde *targetMap ,_cbee []int ){var _faf [][]int ;
for _dba ,_ede :=range _cbde ._bgb {if _gcb (_dba ,_cbee ){continue ;};_faf =append (_faf ,_ede );};_cbde ._bgb =_faf ;};type matchedIndex struct{_fcbf int ;_bcfa int ;_bdece string ;};func _egc (_eec ,_ddc targetMap )(bool ,[]int ){_dbc :=_cd .Contains (_eec ._cbca ,_ddc ._cbca );
var _gcbe []int ;for _ ,_gefa :=range _eec ._bgb {for _gbf ,_eccg :=range _ddc ._bgb {if _eccg [0]>=_gefa [0]&&_eccg [1]<=_gefa [1]{_gcbe =append (_gcbe ,_gbf );};};};return _dbc ,_gcbe ;};func (_baed *Redactor )redactPage (_dab *_cg .ContentStreamOperations ,_fbdc *_g .PdfPageResources )([]matchedBBox ,*_cg .ContentStreamOperations ,error ){_gee ,_edbg :=_ba .NewFromContents (_dab .String (),_fbdc );
if _edbg !=nil {return nil ,nil ,_edbg ;};_ded ,_ ,_ ,_edbg :=_gee .ExtractPageText ();if _edbg !=nil {return nil ,nil ,_edbg ;};_dab =_ded .GetContentStreamOps ();_cdf :=_ded .Marks ();_cbeg :=_ded .Text ();_cbeg ,_aebg :=_dde (_cbeg );_gad :=[]matchedBBox {};
_aga :=make (map[_ce .PdfObject ][]localSpanMarks );_bfgb :=[]*targetMap {};for _ ,_aaccb :=range _baed ._affe .Terms {_gfa ,_cegg :=_egfgb (_aaccb );if _cegg !=nil {return nil ,nil ,_cegg ;};_cbg ,_cegg :=_gfa .match (_cbeg );if _cegg !=nil {return nil ,nil ,_cegg ;
};_cbg =_afb (_cbg ,_aebg );_cgeg :=_cgf (_cbg );_bfgb =append (_bfgb ,_cgeg ...);};_dedb (_bfgb );for _ ,_decf :=range _bfgb {_ddaa :=_decf ._cbca ;_adb :=_decf ._bgb ;_efc :=[]matchedBBox {};for _ ,_aec :=range _adb {_edgcc ,_efa ,_ffbc :=_gd (_aec ,_cdf ,_ddaa );
if _ffbc !=nil {return nil ,nil ,_ffbc ;};_fedb :=_gefe (_edgcc );for _acb ,_cbd :=range _fedb {_abcbd :=localSpanMarks {_daff :_cbd ,_bcab :_acb ,_badd :_ddaa };_efg ,_ :=_cgg (_cbd );if _edc ,_fage :=_aga [_efg ];_fage {_aga [_efg ]=append (_edc ,_abcbd );
}else {_aga [_efg ]=[]localSpanMarks {_abcbd };};};_efc =append (_efc ,_efa );};_gad =append (_gad ,_efc ...);};_edbg =_ga (_dab ,_aga );if _edbg !=nil {return nil ,nil ,_edbg ;};return _gad ,_dab ,nil ;};func _gd (_feg []int ,_dbd *_ba .TextMarkArray ,_ecffe string )(*_ba .TextMarkArray ,matchedBBox ,error ){_dbfe :=matchedBBox {};
_baa :=_feg [0];_bbae :=_feg [1];_dgg :=len (_ecffe )-len (_cd .TrimLeft (_ecffe ,"\u0020"));_edcf :=len (_ecffe )-len (_cd .TrimRight (_ecffe ,"\u0020\u000a"));_baa =_baa +_dgg ;_bbae =_bbae -_edcf ;_ecffe =_cd .Trim (_ecffe ,"\u0020\u000a");_ddf ,_eage :=_dbd .RangeOffset (_baa ,_bbae );
if _eage !=nil {return nil ,_dbfe ,_eage ;};_cfag ,_gffc :=_ddf .BBox ();if !_gffc {return nil ,_dbfe ,_b .Errorf ("\u0073\u0070\u0061\u006e\u004d\u0061\u0072\u006bs\u002e\u0042\u0042ox\u0020\u0068\u0061\u0073\u0020\u006eo\u0020\u0062\u006f\u0075\u006e\u0064\u0069\u006e\u0067\u0020\u0062\u006f\u0078\u002e\u0020s\u0070\u0061\u006e\u004d\u0061\u0072\u006b\u0073=\u0025\u0073",_ddf );
};_dbfe =matchedBBox {_daf :_ecffe ,_ggcd :_cfag };return _ddf ,_dbfe ,nil ;};func _cgg (_fdb *_ba .TextMarkArray )(_ce .PdfObject ,int ){var _gafa _ce .PdfObject ;_cdd :=-1;for _fcf ,_bf :=range _fdb .Elements (){_gafa =_bf .DirectObject ;_cdd =_fcf ;
if _gafa !=nil {break ;};};return _gafa ,_cdd ;};type placeHolders struct{_fd []int ;_bg string ;_bb float64 ;};

// Write writes the content of `re.creator` to writer of type io.Writer interface.
func (_bdcb *Redactor )Write (writer _c .Writer )error {return _bdcb ._ecc .Write (writer )};func _dedb (_bdee []*targetMap ){for _dge ,_gfdg :=range _bdee {for _gef ,_efb :=range _bdee {if _dge !=_gef {_aafb ,_dgdg :=_egc (*_gfdg ,*_efb );if _aafb {_ffg (_efb ,_dgdg );
};};};};};

// WriteToFile writes the redacted document to file specified by `outputPath`.
func (_cafc *Redactor )WriteToFile (outputPath string )error {if _dbfc :=_cafc ._ecc .WriteToFile (outputPath );_dbfc !=nil {return _b .Errorf ("\u0066\u0061\u0069l\u0065\u0064\u0020\u0074o\u0020\u0077\u0072\u0069\u0074\u0065\u0020t\u0068\u0065\u0020\u006f\u0075\u0074\u0070\u0075\u0074\u0020\u0066\u0069\u006c\u0065");
};return nil ;};type regexMatcher struct{_abgc RedactionTerm };

// RedactionOptions is a collection of RedactionTerm objects.
type RedactionOptions struct{Terms []RedactionTerm ;};func _ffbe (_cfdf *matchedIndex ,_debbd [][]int )[]*matchedIndex {_gdb :=[]*matchedIndex {};_baef :=_cfdf ._fcbf ;_eaeb :=_baef ;_dffg :=_cfdf ._bdece ;_deegd :=0;for _ ,_bcfag :=range _debbd {_eaf :=_bcfag [0]-_baef ;
if _deegd >=_eaf {continue ;};_fabb :=_dffg [_deegd :_eaf ];_ffe :=&matchedIndex {_bdece :_fabb ,_fcbf :_eaeb ,_bcfa :_bcfag [0]};if len (_cd .TrimSpace (_fabb ))!=0{_gdb =append (_gdb ,_ffe );};_deegd =_bcfag [1]-_baef ;_eaeb =_baef +_deegd ;};_geec :=_dffg [_deegd :];
_cdfd :=&matchedIndex {_bdece :_geec ,_fcbf :_eaeb ,_bcfa :_cfdf ._bcfa };if len (_cd .TrimSpace (_geec ))!=0{_gdb =append (_gdb ,_cdfd );};return _gdb ;};func _ebd (_def *_ba .TextMarkArray )(float64 ,error ){_gfbe ,_bdb :=_def .BBox ();if !_bdb {return 0.0,_b .Errorf ("\u0073\u0070\u0061\u006e\u004d\u0061\u0072\u006bs\u002e\u0042\u0042ox\u0020\u0068\u0061\u0073\u0020\u006eo\u0020\u0062\u006f\u0075\u006e\u0064\u0069\u006e\u0067\u0020\u0062\u006f\u0078\u002e\u0020s\u0070\u0061\u006e\u004d\u0061\u0072\u006b\u0073=\u0025\u0073",_def );
};_cde :=_eg (_def );_fagd :=0.0;_ ,_beeg :=_cgg (_def );_ef :=_def .Elements ()[_beeg ];_feag :=_ef .Font ;if _cde > 0{_fagd =_acfc (_feag ,_ef );};_acfe :=(_gfbe .Urx -_gfbe .Llx );_acfe =_acfe +_fagd *float64 (_cde );Tj :=_gede (_acfe ,_ef .FontSize ,_ef .Th );
return Tj ,nil ;};

// New instantiates a Redactor object with given PdfReader and `regex` pattern.
func New (reader *_g .PdfReader ,opts *RedactionOptions ,rectProps *RectangleProps )*Redactor {if rectProps ==nil {rectProps =RedactRectanglePropsNew ();};return &Redactor {_fdd :reader ,_affe :opts ,_ecc :_cc .New (),_bge :rectProps };};func _ca (_abf []localSpanMarks )(map[string ][]localSpanMarks ,[]string ){_fdbg :=make (map[string ][]localSpanMarks );
_aad :=[]string {};for _ ,_abc :=range _abf {_bdf :=_abc ._badd ;if _eb ,_geda :=_fdbg [_bdf ];_geda {_fdbg [_bdf ]=append (_eb ,_abc );}else {_fdbg [_bdf ]=[]localSpanMarks {_abc };_aad =append (_aad ,_bdf );};};return _fdbg ,_aad ;};func _gfcd (_dgba string ,_cdga []replacement ,_gcf *_g .PdfFont )[]_ce .PdfObject {_fbd :=[]_ce .PdfObject {};
_dcf :=0;_gag :=_dgba ;for _bfe ,_agd :=range _cdga {_ggc :=_agd ._fg ;_ade :=_agd ._fc ;_bdec :=_agd ._baf ;_gbdd :=_ce .MakeFloat (_ade );if _dcf > _ggc ||_ggc ==-1{continue ;};_bafg :=_dgba [_dcf :_ggc ];_bcc :=_gfb (_bafg ,_gcf );_bgaa :=_ce .MakeStringFromBytes (_bcc );
_fbd =append (_fbd ,_bgaa );_fbd =append (_fbd ,_gbdd );_fga :=_ggc +len (_bdec );_gag =_dgba [_fga :];_dcf =_fga ;if _bfe ==len (_cdga )-1{_bcc =_gfb (_gag ,_gcf );_bgaa =_ce .MakeStringFromBytes (_bcc );_fbd =append (_fbd ,_bgaa );};};return _fbd ;};
func _afb (_dff []*matchedIndex ,_ebge [][]int )[]*matchedIndex {_cdeb :=[]*matchedIndex {};for _ ,_cggb :=range _dff {_defa ,_bdccg :=_bcce (_cggb ,_ebge );if _defa {_fbadf :=_ffbe (_cggb ,_bdccg );_cdeb =append (_cdeb ,_fbadf ...);}else {_cdeb =append (_cdeb ,_cggb );
};};return _cdeb ;};func _fee (_fbe *_ba .TextMarkArray )string {_badf :="";for _ ,_dcd :=range _fbe .Elements (){_badf +=_dcd .Text ;};return _badf ;};func _bfeb (_ecfg *_ba .TextMarkArray ,_gaee int ,_egfg int )int {_daffc :=_ecfg .Elements ();_abag :=_gaee -1;
_aafg :=_gaee +1;_cag :=-1;if _abag >=0{_fafg :=_daffc [_abag ];_bcb :=_fafg .ObjString ;_dabg :=len (_bcb );_fde :=_fafg .Index ;if _fde +1< _dabg {_cag =_abag ;return _cag ;};};if _aafg < len (_daffc ){_bggc :=_daffc [_aafg ];_dabf :=_bggc .ObjString ;
if _dabf [0]!=_bggc .Text {_cag =_aafg ;return _cag ;};};return _cag ;};func _eg (_aac *_ba .TextMarkArray )int {_dg :=0;_ae :=_aac .Elements ();if _ae [0].Text =="\u0020"{_dg ++;};if _ae [_aac .Len ()-1].Text =="\u0020"{_dg ++;};return _dg ;};

// RectangleProps defines properties of the redaction rectangle to be drawn.
type RectangleProps struct{FillColor _cc .Color ;BorderWidth float64 ;FillOpacity float64 ;};func _gefe (_gccg *_ba .TextMarkArray )[]*_ba .TextMarkArray {_gce :=_gccg .Elements ();_fbeg :=len (_gce );var _ccc _ce .PdfObject ;_eff :=[]*_ba .TextMarkArray {};
_efgb :=&_ba .TextMarkArray {};_gba :=-1;for _ggff ,_bdeb :=range _gce {_dbfd :=_bdeb .DirectObject ;_gba =_bdeb .Index ;if _dbfd ==nil {_ebc :=_bfeb (_gccg ,_ggff ,_gba );if _ccc !=nil {if _ebc ==-1||_ebc > _ggff {_eff =append (_eff ,_efgb );_efgb =&_ba .TextMarkArray {};
};};}else if _dbfd !=nil &&_ccc ==nil {if _gba ==0&&_ggff > 0{_eff =append (_eff ,_efgb );_efgb =&_ba .TextMarkArray {};};}else if _dbfd !=nil &&_ccc !=nil {if _dbfd !=_ccc {_eff =append (_eff ,_efgb );_efgb =&_ba .TextMarkArray {};};};_ccc =_dbfd ;_efgb .Append (_bdeb );
if _ggff ==(_fbeg -1){_eff =append (_eff ,_efgb );};};return _eff ;};func (_bbdg *regexMatcher )match (_daffb string )([]*matchedIndex ,error ){_edaa :=_bbdg ._abgc .Pattern ;if _edaa ==nil {return nil ,_db .New ("\u006e\u006f\u0020\u0070at\u0074\u0065\u0072\u006e\u0020\u0063\u006f\u006d\u0070\u0069\u006c\u0065\u0064");
};var (_afd =_edaa .FindAllStringIndex (_daffb ,-1);_fcae []*matchedIndex ;);for _ ,_dca :=range _afd {_fcae =append (_fcae ,&matchedIndex {_fcbf :_dca [0],_bcfa :_dca [1],_bdece :_daffb [_dca [0]:_dca [1]]});};return _fcae ,nil ;};func _gfb (_bea string ,_ag *_g .PdfFont )[]byte {_beb ,_ggf :=_ag .StringToCharcodeBytes (_bea );
if _ggf !=0{_a .Log .Debug ("\u0057\u0041\u0052\u004e\u003a\u0020\u0073\u006fm\u0065\u0020\u0072un\u0065\u0073\u0020\u0063\u006f\u0075l\u0064\u0020\u006e\u006f\u0074\u0020\u0062\u0065\u0020\u0065\u006e\u0063\u006f\u0064\u0065d\u002e\u000a\u0009\u0025\u0073\u0020\u002d\u003e \u0025\u0076",_bea ,_beb );
};return _beb ;};type localSpanMarks struct{_daff *_ba .TextMarkArray ;_bcab int ;_badd string ;};func _gbd (_bgd *_ba .TextMarkArray )*_g .PdfFont {_ ,_fec :=_cgg (_bgd );_cee :=_bgd .Elements ()[_fec ];_gacf :=_cee .Font ;return _gacf ;};

// Redactor represents a Redactor object.
type Redactor struct{_fdd *_g .PdfReader ;_affe *RedactionOptions ;_ecc *_cc .Creator ;_bge *RectangleProps ;};func _gede (_cdag ,_gae ,_cfd float64 )float64 {_cfd =_cfd /100;_gacd :=(-1000*_cdag )/(_gae *_cfd );return _gacd ;};func _cecc (_bbb localSpanMarks ,_gab *_ba .TextMarkArray ,_abe *_g .PdfFont ,_ffcg ,_geb string )([]_ce .PdfObject ,error ){_da :=_fee (_gab );
Tj ,_bac :=_ebd (_gab );if _bac !=nil {return nil ,_bac ;};_aff :=len (_ffcg );_eag :=len (_da );_ceg :=-1;_dda :=_ce .MakeFloat (Tj );if _da !=_geb {_dc :=_bbb ._bcab ;if _dc ==0{_ceg =_cd .LastIndex (_ffcg ,_da );}else {_ceg =_cd .Index (_ffcg ,_da );
};}else {_ceg =_cd .Index (_ffcg ,_da );};_cad :=_ceg +_eag ;_cbf :=[]_ce .PdfObject {};if _ceg ==0&&_cad ==_aff {_cbf =append (_cbf ,_dda );}else if _ceg ==0&&_cad < _aff {_cdgc :=_gfb (_ffcg [_cad :],_abe );_fcbb :=_ce .MakeStringFromBytes (_cdgc );_cbf =append (_cbf ,_dda ,_fcbb );
}else if _ceg > 0&&_cad >=_aff {_acab :=_gfb (_ffcg [:_ceg ],_abe );_fff :=_ce .MakeStringFromBytes (_acab );_cbf =append (_cbf ,_fff ,_dda );}else if _ceg > 0&&_cad < _aff {_aeec :=_gfb (_ffcg [:_ceg ],_abe );_bcf :=_gfb (_ffcg [_cad :],_abe );_fed :=_ce .MakeStringFromBytes (_aeec );
_fca :=_ce .MakeString (string (_bcf ));_cbf =append (_cbf ,_fed ,_dda ,_fca );};return _cbf ,nil ;};func _egfgb (_eabd RedactionTerm )(*regexMatcher ,error ){return &regexMatcher {_abgc :_eabd },nil };
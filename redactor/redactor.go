//
// Copyright 2020 FoxyUtils ehf. All rights reserved.
//
// This is a commercial product and requires a license to operate.
// A trial license can be obtained at https://unidoc.io
//
// DO NOT EDIT: generated by unitwist Go source code obfuscator.
//
// Use of this source code is governed by the UniDoc End User License Agreement
// terms that can be accessed at https://unidoc.io/eula/

package redactor ;import (_a "errors";_d "fmt";_af "github.com/unidoc/unipdf/v4/common";_gb "github.com/unidoc/unipdf/v4/contentstream";_fd "github.com/unidoc/unipdf/v4/core";_dg "github.com/unidoc/unipdf/v4/creator";_b "github.com/unidoc/unipdf/v4/extractor";
_f "github.com/unidoc/unipdf/v4/model";_ee "io";_ef "regexp";_eeb "sort";_g "strings";);func _gef (_cda *_b .TextMarkArray )(float64 ,error ){_cbg ,_eea :=_cda .BBox ();if !_eea {return 0.0,_d .Errorf ("\u0073\u0070\u0061\u006e\u004d\u0061\u0072\u006bs\u002e\u0042\u0042ox\u0020\u0068\u0061\u0073\u0020\u006eo\u0020\u0062\u006f\u0075\u006e\u0064\u0069\u006e\u0067\u0020\u0062\u006f\u0078\u002e\u0020s\u0070\u0061\u006e\u004d\u0061\u0072\u006b\u0073=\u0025\u0073",_cda );
};_cgaa :=_cf (_cda );_ffa :=0.0;_ ,_dbd :=_fdg (_cda );_fcaf :=_cda .Elements ()[_dbd ];_ffd :=_fcaf .Font ;if _cgaa > 0{_ffa =_fb (_ffd ,_fcaf );};_bad :=(_cbg .Urx -_cbg .Llx );_bad =_bad +_ffa *float64 (_cgaa );Tj :=_dgf (_bad ,_fcaf .FontSize ,_fcaf .Th );
return Tj ,nil ;};func _acff (_eceb *_gb .ContentStreamOperations ,PdfObj _fd .PdfObject )(*_gb .ContentStreamOperation ,int ,bool ){for _fdga ,_gcf :=range *_eceb {_fgg :=_gcf .Operand ;if _fgg =="\u0054\u006a"{_fdgf :=_fd .TraceToDirectObject (_gcf .Params [0]);
if _fdgf ==PdfObj {return _gcf ,_fdga ,true ;};}else if _fgg =="\u0054\u004a"{_efaf ,_gcd :=_fd .GetArray (_gcf .Params [0]);if !_gcd {return nil ,_fdga ,_gcd ;};for _ ,_cdac :=range _efaf .Elements (){if _cdac ==PdfObj {return _gcf ,_fdga ,true ;};};}else if _fgg =="\u0022"{_egb :=_fd .TraceToDirectObject (_gcf .Params [2]);
if _egb ==PdfObj {return _gcf ,_fdga ,true ;};}else if _fgg =="\u0027"{_agd :=_fd .TraceToDirectObject (_gcf .Params [0]);if _agd ==PdfObj {return _gcf ,_fdga ,true ;};};};return nil ,-1,false ;};func _fdg (_eec *_b .TextMarkArray )(_fd .PdfObject ,int ){var _cfg _fd .PdfObject ;
_ecg :=-1;for _eebe ,_fcb :=range _eec .Elements (){_cfg =_fcb .DirectObject ;_ecg =_eebe ;if _cfg !=nil {break ;};};return _cfg ,_ecg ;};type replacement struct{_ff string ;_gd float64 ;_be int ;};func _cdf (_aac []localSpanMarks )(map[string ][]localSpanMarks ,[]string ){_fce :=make (map[string ][]localSpanMarks );
_abf :=[]string {};for _ ,_agf :=range _aac {_ccd :=_agf ._fddg ;if _ggg ,_cga :=_fce [_ccd ];_cga {_fce [_ccd ]=append (_ggg ,_agf );}else {_fce [_ccd ]=[]localSpanMarks {_agf };_abf =append (_abf ,_ccd );};};return _fce ,_abf ;};type matchedIndex struct{_bbad int ;
_add int ;_fdgc string ;};

// Write writes the content of `re.creator` to writer of type io.Writer interface.
func (_aefg *Redactor )Write (writer _ee .Writer )error {return _aefg ._dag .Write (writer )};func _fadd (_aec *matchedIndex ,_gabg [][]int )[]*matchedIndex {_ebac :=[]*matchedIndex {};_eeab :=_aec ._bbad ;_gca :=_eeab ;_cgcg :=_aec ._fdgc ;_geea :=0;for _ ,_afcb :=range _gabg {_bcg :=_afcb [0]-_eeab ;
if _geea >=_bcg {continue ;};_gafg :=_cgcg [_geea :_bcg ];_fdea :=&matchedIndex {_fdgc :_gafg ,_bbad :_gca ,_add :_afcb [0]};if len (_g .TrimSpace (_gafg ))!=0{_ebac =append (_ebac ,_fdea );};_geea =_afcb [1]-_eeab ;_gca =_eeab +_geea ;};_cfbb :=_cgcg [_geea :];
_age :=&matchedIndex {_fdgc :_cfbb ,_bbad :_gca ,_add :_aec ._add };if len (_g .TrimSpace (_cfbb ))!=0{_ebac =append (_ebac ,_age );};return _ebac ;};

// RedactRectanglePropsNew return a new pointer to a default RectangleProps object.
func RedactRectanglePropsNew ()*RectangleProps {return &RectangleProps {FillColor :_dg .ColorBlack ,BorderWidth :0.0,FillOpacity :1.0};};func _eedb (_gcg _fd .PdfObject ,_eac *_f .PdfFont )(string ,error ){_cfc ,_ebc :=_fd .GetStringBytes (_gcg );if !_ebc {return "",_fd .ErrTypeError ;
};_cba :=_eac .BytesToCharcodes (_cfc );_ged ,_efgf ,_ggde :=_eac .CharcodesToStrings (_cba ,"");if _ggde > 0{_af .Log .Debug ("\u0072\u0065nd\u0065\u0072\u0054e\u0078\u0074\u003a\u0020num\u0043ha\u0072\u0073\u003d\u0025\u0064\u0020\u006eum\u004d\u0069\u0073\u0073\u0065\u0073\u003d%\u0064",_efgf ,_ggde );
};_dbb :=_g .Join (_ged ,"");return _dbb ,nil ;};func _beac (_abgg []int ,_cfgd *_b .TextMarkArray ,_aedaf string )(*_b .TextMarkArray ,matchedBBox ,error ){_fead :=matchedBBox {};_dcef :=_abgg [0];_cdad :=_abgg [1];_dfba :=len (_aedaf )-len (_g .TrimLeft (_aedaf ,"\u0020"));
_febe :=len (_aedaf )-len (_g .TrimRight (_aedaf ,"\u0020\u000a"));_dcef =_dcef +_dfba ;_cdad =_cdad -_febe ;_aedaf =_g .Trim (_aedaf ,"\u0020\u000a");_acd ,_bfdg :=_cfgd .RangeOffset (_dcef ,_cdad );if _bfdg !=nil {return nil ,_fead ,_bfdg ;};_eegg ,_aaf :=_acd .BBox ();
if !_aaf {return nil ,_fead ,_d .Errorf ("\u0073\u0070\u0061\u006e\u004d\u0061\u0072\u006bs\u002e\u0042\u0042ox\u0020\u0068\u0061\u0073\u0020\u006eo\u0020\u0062\u006f\u0075\u006e\u0064\u0069\u006e\u0067\u0020\u0062\u006f\u0078\u002e\u0020s\u0070\u0061\u006e\u004d\u0061\u0072\u006b\u0073=\u0025\u0073",_acd );
};_fead =matchedBBox {_dce :_aedaf ,_cdca :_eegg };return _acd ,_fead ,nil ;};type matchedBBox struct{_cdca _f .PdfRectangle ;_dce string ;};func _bbc (_dfgc ,_cefc targetMap )(bool ,[]int ){_aaeb :=_g .Contains (_dfgc ._dfb ,_cefc ._dfb );var _afbb []int ;
for _ ,_bbgg :=range _dfgc ._ggb {for _gada ,_eace :=range _cefc ._ggb {if _eace [0]>=_bbgg [0]&&_eace [1]<=_bbgg [1]{_afbb =append (_afbb ,_gada );};};};return _aaeb ,_afbb ;};

// RedactionOptions is a collection of RedactionTerm objects.
type RedactionOptions struct{Terms []RedactionTerm ;};func _cc (_gaf string ,_gbc *_f .PdfFont )[]byte {_dgc ,_bba :=_gbc .StringToCharcodeBytes (_gaf );if _bba !=0{_af .Log .Debug ("\u0057\u0041\u0052\u004e\u003a\u0020\u0073\u006fm\u0065\u0020\u0072un\u0065\u0073\u0020\u0063\u006f\u0075l\u0064\u0020\u006e\u006f\u0074\u0020\u0062\u0065\u0020\u0065\u006e\u0063\u006f\u0064\u0065d\u002e\u000a\u0009\u0025\u0073\u0020\u002d\u003e \u0025\u0076",_gaf ,_dgc );
};return _dgc ;};func _gee (_gf ,_fdae string )[]int {if len (_fdae )==0{return nil ;};var _bagg []int ;for _bgag :=0;_bgag < len (_gf );{_fcefg :=_g .Index (_gf [_bgag :],_fdae );if _fcefg < 0{return _bagg ;};_bagg =append (_bagg ,_bgag +_fcefg );_bgag +=_fcefg +len (_fdae );
};return _bagg ;};func _ed (_gad *_gb .ContentStreamOperations ,_c map[_fd .PdfObject ][]localSpanMarks )error {for _dge ,_fcc :=range _c {if _dge ==nil {continue ;};_bd ,_fg ,_cg :=_acff (_gad ,_dge );if !_cg {_af .Log .Debug ("Pd\u0066\u004fb\u006a\u0065\u0063\u0074\u0020\u0025\u0073\u006e\u006ft\u0020\u0066\u006f\u0075\u006e\u0064\u0020\u0069\u006e\u0020\u0073\u0069\u0064\u0065\u0020\u0074\u0068\u0065\u0020\u0063\u006f\u006e\u0074\u0065\u006e\u0074\u0073\u0074r\u0065a\u006d\u0020\u006f\u0070\u0065\u0072\u0061\u0074i\u006fn\u0020\u0025s",_dge ,_gad );
return nil ;};if _bd .Operand =="\u0054\u006a"{_db :=_ecb (_bd ,_dge ,_fcc );if _db !=nil {return _db ;};}else if _bd .Operand =="\u0054\u004a"{_df :=_aff (_bd ,_dge ,_fcc );if _df !=nil {return _df ;};}else if _bd .Operand =="\u0027"||_bd .Operand =="\u0022"{_ea :=_bdd (_gad ,_bd .Operand ,_fg );
if _ea !=nil {return _ea ;};_ea =_ecb (_bd ,_dge ,_fcc );if _ea !=nil {return _ea ;};};};return nil ;};func _bdd (_eg *_gb .ContentStreamOperations ,_gbg string ,_afg int )error {_cgf :=_gb .ContentStreamOperations {};var _egg _gb .ContentStreamOperation ;
for _ece ,_beg :=range *_eg {if _ece ==_afg {if _gbg =="\u0027"{_cd :=_gb .ContentStreamOperation {Operand :"\u0054\u002a"};_cgf =append (_cgf ,&_cd );_egg .Params =_beg .Params ;_egg .Operand ="\u0054\u006a";_cgf =append (_cgf ,&_egg );}else if _gbg =="\u0022"{_bf :=_beg .Params [:2];
Tc ,Tw :=_bf [0],_bf [1];_ba :=_gb .ContentStreamOperation {Params :[]_fd .PdfObject {Tc },Operand :"\u0054\u0063"};_cgf =append (_cgf ,&_ba );_ba =_gb .ContentStreamOperation {Params :[]_fd .PdfObject {Tw },Operand :"\u0054\u0077"};_cgf =append (_cgf ,&_ba );
_egg .Params =[]_fd .PdfObject {_beg .Params [2]};_egg .Operand ="\u0054\u006a";_cgf =append (_cgf ,&_egg );};};_cgf =append (_cgf ,_beg );};*_eg =_cgf ;return nil ;};func _aeg (_ccc *_b .TextMarkArray )string {_cac :="";for _ ,_bade :=range _ccc .Elements (){_cac +=_bade .Text ;
};return _cac ;};func (_afb *Redactor )redactPage (_bed *_gb .ContentStreamOperations ,_bbf *_f .PdfPageResources )([]matchedBBox ,*_gb .ContentStreamOperations ,error ){_fdf ,_fad :=_b .NewFromContents (_bed .String (),_bbf );if _fad !=nil {return nil ,nil ,_fad ;
};_ffee ,_ ,_ ,_fad :=_fdf .ExtractPageText ();if _fad !=nil {return nil ,nil ,_fad ;};_bed =_ffee .GetContentStreamOps ();_bedc :=_ffee .Marks ();_fcec :=_ffee .Text ();_fcec ,_fdfd :=_eeae (_fcec );_bcb :=[]matchedBBox {};_gabc :=make (map[_fd .PdfObject ][]localSpanMarks );
_cef :=[]*targetMap {};for _ ,_gdd :=range _afb ._eda .Terms {_cfag ,_bgd :=_edg (_gdd );if _bgd !=nil {return nil ,nil ,_bgd ;};_cae ,_bgd :=_cfag .match (_fcec );if _bgd !=nil {return nil ,nil ,_bgd ;};_cae =_gge (_cae ,_fdfd );_bbg :=_eff (_cae );_cef =append (_cef ,_bbg ...);
};_ecba (_cef );for _ ,_aea :=range _cef {_daa :=_aea ._dfb ;_dgec :=_aea ._ggb ;_bbgd :=[]matchedBBox {};for _ ,_eeff :=range _dgec {_cacb ,_cag ,_ebdf :=_beac (_eeff ,_bedc ,_daa );if _ebdf !=nil {return nil ,nil ,_ebdf ;};_bda :=_dged (_cacb );for _cbfg ,_ccda :=range _bda {_bfd :=localSpanMarks {_dega :_ccda ,_fggc :_cbfg ,_fddg :_daa };
_affg ,_ :=_fdg (_ccda );if _bfa ,_ega :=_gabc [_affg ];_ega {_gabc [_affg ]=append (_bfa ,_bfd );}else {_gabc [_affg ]=[]localSpanMarks {_bfd };};};_bbgd =append (_bbgd ,_cag );};_bcb =append (_bcb ,_bbgd ...);};_fad =_ed (_bed ,_gabc );if _fad !=nil {return nil ,nil ,_fad ;
};return _bcb ,_bed ,nil ;};func _abcb (_fda localSpanMarks ,_bbac *_b .TextMarkArray ,_eb *_f .PdfFont ,_bfc ,_fcef string )([]_fd .PdfObject ,error ){_gcbb :=_aeg (_bbac );Tj ,_gag :=_gef (_bbac );if _gag !=nil {return nil ,_gag ;};_aae :=len (_bfc );
_aga :=len (_gcbb );_abe :=-1;_adf :=_fd .MakeFloat (Tj );if _gcbb !=_fcef {_fba :=_fda ._fggc ;if _fba ==0{_abe =_g .LastIndex (_bfc ,_gcbb );}else {_abe =_g .Index (_bfc ,_gcbb );};}else {_abe =_g .Index (_bfc ,_gcbb );};_dbc :=_abe +_aga ;_aab :=[]_fd .PdfObject {};
if _abe ==0&&_dbc ==_aae {_aab =append (_aab ,_adf );}else if _abe ==0&&_dbc < _aae {_fef :=_cc (_bfc [_dbc :],_eb );_agce :=_fd .MakeStringFromBytes (_fef );_aab =append (_aab ,_adf ,_agce );}else if _abe > 0&&_dbc >=_aae {_bfg :=_cc (_bfc [:_abe ],_eb );
_cfae :=_fd .MakeStringFromBytes (_bfg );_aab =append (_aab ,_cfae ,_adf );}else if _abe > 0&&_dbc < _aae {_dbca :=_cc (_bfc [:_abe ],_eb );_fgbc :=_cc (_bfc [_dbc :],_eb );_cee :=_fd .MakeStringFromBytes (_dbca );_egc :=_fd .MakeString (string (_fgbc ));
_aab =append (_aab ,_cee ,_adf ,_egc );};return _aab ,nil ;};func _afe (_fbb *_b .TextMarkArray )*_f .PdfFont {_ ,_geg :=_fdg (_fbb );_afga :=_fbb .Elements ()[_geg ];_ead :=_afga .Font ;return _ead ;};func _dged (_aad *_b .TextMarkArray )[]*_b .TextMarkArray {_cfaa :=_aad .Elements ();
_dda :=len (_cfaa );var _egag _fd .PdfObject ;_eefd :=[]*_b .TextMarkArray {};_fefe :=&_b .TextMarkArray {};_gdgg :=-1;for _afd ,_eba :=range _cfaa {_cead :=_eba .DirectObject ;_gdgg =_eba .Index ;if _cead ==nil {_baf :=_fbga (_aad ,_afd ,_gdgg );if _egag !=nil {if _baf ==-1||_baf > _afd {_eefd =append (_eefd ,_fefe );
_fefe =&_b .TextMarkArray {};};};}else if _cead !=nil &&_egag ==nil {if _gdgg ==0&&_afd > 0{_eefd =append (_eefd ,_fefe );_fefe =&_b .TextMarkArray {};};}else if _cead !=nil &&_egag !=nil {if _cead !=_egag {_eefd =append (_eefd ,_fefe );_fefe =&_b .TextMarkArray {};
};};_egag =_cead ;_fefe .Append (_eba );if _afd ==(_dda -1){_eefd =append (_eefd ,_fefe );};};return _eefd ;};

// RectangleProps defines properties of the redaction rectangle to be drawn.
type RectangleProps struct{FillColor _dg .Color ;BorderWidth float64 ;FillOpacity float64 ;};func _abcg (_fceb string ,_dfe []replacement ,_ecab *_f .PdfFont )[]_fd .PdfObject {_aag :=[]_fd .PdfObject {};_efg :=0;_ddf :=_fceb ;for _ca ,_fddb :=range _dfe {_ddfe :=_fddb ._be ;
_fgc :=_fddb ._gd ;_bea :=_fddb ._ff ;_abb :=_fd .MakeFloat (_fgc );if _efg > _ddfe ||_ddfe ==-1{continue ;};_abgc :=_fceb [_efg :_ddfe ];_cbf :=_cc (_abgc ,_ecab );_caf :=_fd .MakeStringFromBytes (_cbf );_aag =append (_aag ,_caf );_aag =append (_aag ,_abb );
_cab :=_ddfe +len (_bea );_ddf =_fceb [_cab :];_efg =_cab ;if _ca ==len (_dfe )-1{_cbf =_cc (_ddf ,_ecab );_caf =_fd .MakeStringFromBytes (_cbf );_aag =append (_aag ,_caf );};};return _aag ;};func (_ceada *regexMatcher )match (_cegb string )([]*matchedIndex ,error ){_abd :=_ceada ._fgga .Pattern ;
if _abd ==nil {return nil ,_a .New ("\u006e\u006f\u0020\u0070at\u0074\u0065\u0072\u006e\u0020\u0063\u006f\u006d\u0070\u0069\u006c\u0065\u0064");};var (_begg =_abd .FindAllStringIndex (_cegb ,-1);_dcfe []*matchedIndex ;);for _ ,_fgea :=range _begg {_dcfe =append (_dcfe ,&matchedIndex {_bbad :_fgea [0],_add :_fgea [1],_fdgc :_cegb [_fgea [0]:_fgea [1]]});
};return _dcfe ,nil ;};type localSpanMarks struct{_dega *_b .TextMarkArray ;_fggc int ;_fddg string ;};func _eeae (_cfac string )(string ,[][]int ){_ddad :=_ef .MustCompile ("\u005c\u006e");_cgcc :=_ddad .FindAllStringIndex (_cfac ,-1);_dfed :=_ddad .ReplaceAllString (_cfac ,"\u0020");
return _dfed ,_cgcc ;};func _cf (_fcg *_b .TextMarkArray )int {_eef :=0;_bff :=_fcg .Elements ();if _bff [0].Text =="\u0020"{_eef ++;};if _bff [_fcg .Len ()-1].Text =="\u0020"{_eef ++;};return _eef ;};func _fge (_fga int ,_bac []int )bool {for _ ,_dbcd :=range _bac {if _dbcd ==_fga {return true ;
};};return false ;};func _feg (_caee *targetMap ,_gaef []int ){var _cdfb [][]int ;for _ccfd ,_gbcbd :=range _caee ._ggb {if _fge (_ccfd ,_gaef ){continue ;};_cdfb =append (_cdfb ,_gbcbd );};_caee ._ggb =_cdfb ;};type regexMatcher struct{_fgga RedactionTerm };
func _ecb (_deg *_gb .ContentStreamOperation ,_ceg _fd .PdfObject ,_cec []localSpanMarks )error {var _dgcc *_fd .PdfObjectArray ;_ggd ,_bc :=_cdf (_cec );if len (_bc )==1{_gcb :=_bc [0];_dgd :=_ggd [_gcb ];if len (_dgd )==1{_agc :=_dgd [0];_bg :=_agc ._dega ;
_eca :=_afe (_bg );_begb ,_gce :=_eedb (_ceg ,_eca );if _gce !=nil {return _gce ;};_dbe ,_gce :=_abcb (_agc ,_bg ,_eca ,_begb ,_gcb );if _gce !=nil {return _gce ;};_dgcc =_fd .MakeArray (_dbe ...);}else {_fde :=_dgd [0]._dega ;_gafa :=_afe (_fde );_bee ,_cbb :=_eedb (_ceg ,_gafa );
if _cbb !=nil {return _cbb ;};_da ,_cbb :=_bga (_bee ,_dgd );if _cbb !=nil {return _cbb ;};_cfa :=_fdec (_da );_cbdg :=_abcg (_bee ,_cfa ,_gafa );_dgcc =_fd .MakeArray (_cbdg ...);};}else if len (_bc )> 1{_gbcd :=_cec [0];_feb :=_gbcd ._dega ;_ ,_dcc :=_fdg (_feb );
_gec :=_feb .Elements ()[_dcc ];_gbcb :=_gec .Font ;_aaa ,_efa :=_eedb (_ceg ,_gbcb );if _efa !=nil {return _efa ;};_bgg ,_efa :=_bga (_aaa ,_cec );if _efa !=nil {return _efa ;};_adb :=_fdec (_bgg );_dfg :=_abcg (_aaa ,_adb ,_gbcb );_dgcc =_fd .MakeArray (_dfg ...);
};_deg .Params [0]=_dgcc ;_deg .Operand ="\u0054\u004a";return nil ;};func _gdgb (_ddb *matchedIndex ,_dgaa [][]int )(bool ,[][]int ){_dde :=[][]int {};for _ ,_acac :=range _dgaa {if _ddb ._bbad < _acac [0]&&_ddb ._add > _acac [1]{_dde =append (_dde ,_acac );
};};return len (_dde )> 0,_dde ;};

// WriteToFile writes the redacted document to file specified by `outputPath`.
func (_ecbb *Redactor )WriteToFile (outputPath string )error {if _eee :=_ecbb ._dag .WriteToFile (outputPath );_eee !=nil {return _d .Errorf ("\u0066\u0061\u0069l\u0065\u0064\u0020\u0074o\u0020\u0077\u0072\u0069\u0074\u0065\u0020t\u0068\u0065\u0020\u006f\u0075\u0074\u0070\u0075\u0074\u0020\u0066\u0069\u006c\u0065");
};return nil ;};

// New instantiates a Redactor object with given PdfReader and `regex` pattern.
func New (reader *_f .PdfReader ,opts *RedactionOptions ,rectProps *RectangleProps )*Redactor {if rectProps ==nil {rectProps =RedactRectanglePropsNew ();};return &Redactor {_abgca :reader ,_eda :opts ,_dag :_dg .New (),_cea :rectProps };};

// Redactor represents a Redactor object.
type Redactor struct{_abgca *_f .PdfReader ;_eda *RedactionOptions ;_dag *_dg .Creator ;_cea *RectangleProps ;};func _dgf (_ebe ,_dea ,_cdc float64 )float64 {_cdc =_cdc /100;_ebd :=(-1000*_ebe )/(_dea *_cdc );return _ebd ;};func _fbga (_fac *_b .TextMarkArray ,_bef int ,_aeeb int )int {_beeg :=_fac .Elements ();
_cdb :=_bef -1;_bgdg :=_bef +1;_cgc :=-1;if _cdb >=0{_ccg :=_beeg [_cdb ];_gagd :=_ccg .ObjString ;_agaa :=len (_gagd );_caa :=_ccg .Index ;if _caa +1< _agaa {_cgc =_cdb ;return _cgc ;};};if _bgdg < len (_beeg ){_eegge :=_beeg [_bgdg ];_aedg :=_eegge .ObjString ;
if _aedg [0]!=_eegge .Text {_cgc =_bgdg ;return _cgc ;};};return _cgc ;};

// RedactionTerm holds the regexp pattern and the replacement string for the redaction process.
type RedactionTerm struct{Pattern *_ef .Regexp ;};func _eff (_agb []*matchedIndex )[]*targetMap {_adde :=make (map[string ][][]int );_fddf :=[]*targetMap {};for _ ,_afdg :=range _agb {_ffc :=_afdg ._fdgc ;_bcc :=[]int {_afdg ._bbad ,_afdg ._add };if _fag ,_cdace :=_adde [_ffc ];
_cdace {_adde [_ffc ]=append (_fag ,_bcc );}else {_adde [_ffc ]=[][]int {_bcc };};};for _agg ,_bfb :=range _adde {_efgg :=&targetMap {_dfb :_agg ,_ggb :_bfb };_fddf =append (_fddf ,_efgg );};return _fddf ;};func _fb (_cfbe *_f .PdfFont ,_ce _b .TextMark )float64 {_fgb :=0.001;
_fbg :=_ce .Th /100;if _cfbe .Subtype ()=="\u0054\u0079\u0070e\u0033"{_fgb =1;};_cfbd ,_abc :=_cfbe .GetRuneMetrics (' ');if !_abc {_cfbd ,_abc =_cfbe .GetCharMetrics (32);};if !_abc {_cfbd ,_ =_f .DefaultFont ().GetRuneMetrics (' ');};_fgbb :=_fgb *((_cfbd .Wx *_ce .FontSize +_ce .Tc +_ce .Tw )/_fbg );
return _fgbb ;};func _fdec (_aca []placeHolders )[]replacement {_cbbb :=[]replacement {};for _ ,_afc :=range _aca {_efe :=_afc ._ec ;_cegg :=_afc ._fc ;_eefb :=_afc ._ga ;for _ ,_ada :=range _efe {_bbaf :=replacement {_ff :_cegg ,_gd :_eefb ,_be :_ada };
_cbbb =append (_cbbb ,_bbaf );};};_eeb .Slice (_cbbb ,func (_aef ,_ace int )bool {return _cbbb [_aef ]._be < _cbbb [_ace ]._be });return _cbbb ;};type placeHolders struct{_ec []int ;_fc string ;_ga float64 ;};func _bga (_cdff string ,_ced []localSpanMarks )([]placeHolders ,error ){_abfe :="";
_cfba :=[]placeHolders {};for _dcf ,_egf :=range _ced {_gae :=_egf ._dega ;_ccf :=_egf ._fddg ;_fdda :=_aeg (_gae );_bgab ,_abee :=_gef (_gae );if _abee !=nil {return nil ,_abee ;};if _fdda !=_abfe {var _dga []int ;if _dcf ==0&&_ccf !=_fdda {_cggd :=_g .Index (_cdff ,_fdda );
_dga =[]int {_cggd };}else if _dcf ==len (_ced )-1{_fbd :=_g .LastIndex (_cdff ,_fdda );_dga =[]int {_fbd };}else {_dga =_gee (_cdff ,_fdda );};_dd :=placeHolders {_ec :_dga ,_fc :_fdda ,_ga :_bgab };_cfba =append (_cfba ,_dd );};_abfe =_fdda ;};return _cfba ,nil ;
};func _aff (_fgf *_gb .ContentStreamOperation ,_gdg _fd .PdfObject ,_afgc []localSpanMarks )error {_ag ,_ecc :=_fd .GetArray (_fgf .Params [0]);_fdd :=[]_fd .PdfObject {};if !_ecc {_af .Log .Debug ("\u0045\u0052\u0052OR\u003a\u0020\u0054\u004a\u0020\u006f\u0070\u003d\u0025s\u0020G\u0065t\u0041r\u0072\u0061\u0079\u0056\u0061\u006c\u0020\u0066\u0061\u0069\u006c\u0065\u0064",_fgf );
return _d .Errorf ("\u0073\u0070\u0061\u006e\u004d\u0061\u0072\u006bs\u002e\u0042\u0042ox\u0020\u0068\u0061\u0073\u0020\u006eo\u0020\u0062\u006f\u0075\u006e\u0064\u0069\u006e\u0067\u0020\u0062\u006f\u0078\u002e\u0020s\u0070\u0061\u006e\u004d\u0061\u0072\u006b\u0073=\u0025\u0073",_fgf );
};_cgg ,_bb :=_cdf (_afgc );if len (_bb )==1{_fe :=_bb [0];_gac :=_cgg [_fe ];if len (_gac )==1{_ge :=_gac [0];_ac :=_ge ._dega ;_cb :=_afe (_ac );_eecf ,_gadg :=_eedb (_gdg ,_cb );if _gadg !=nil {return _gadg ;};_ae ,_gadg :=_abcb (_ge ,_ac ,_cb ,_eecf ,_fe );
if _gadg !=nil {return _gadg ;};for _ ,_aa :=range _ag .Elements (){if _aa ==_gdg {_fdd =append (_fdd ,_ae ...);}else {_fdd =append (_fdd ,_aa );};};}else {_cdd :=_gac [0]._dega ;_dbf :=_afe (_cdd );_aed ,_acf :=_eedb (_gdg ,_dbf );if _acf !=nil {return _acf ;
};_dc ,_acf :=_bga (_aed ,_gac );if _acf !=nil {return _acf ;};_fca :=_fdec (_dc );_fa :=_abcg (_aed ,_fca ,_dbf );for _ ,_cdg :=range _ag .Elements (){if _cdg ==_gdg {_fdd =append (_fdd ,_fa ...);}else {_fdd =append (_fdd ,_cdg );};};};_fgf .Params [0]=_fd .MakeArray (_fdd ...);
}else if len (_bb )> 1{_fff :=_afgc [0];_ab :=_fff ._dega ;_ ,_ffe :=_fdg (_ab );_gc :=_ab .Elements ()[_ffe ];_bag :=_gc .Font ;_cfgf ,_dbg :=_eedb (_gdg ,_bag );if _dbg !=nil {return _dbg ;};_edb ,_dbg :=_bga (_cfgf ,_afgc );if _dbg !=nil {return _dbg ;
};_abg :=_fdec (_edb );_de :=_abcg (_cfgf ,_abg ,_bag );for _ ,_aedb :=range _ag .Elements (){if _aedb ==_gdg {_fdd =append (_fdd ,_de ...);}else {_fdd =append (_fdd ,_aedb );};};_fgf .Params [0]=_fd .MakeArray (_fdd ...);};return nil ;};func _edg (_gefc RedactionTerm )(*regexMatcher ,error ){return &regexMatcher {_fgga :_gefc },nil };
type targetMap struct{_dfb string ;_ggb [][]int ;};func _ecba (_aeda []*targetMap ){for _gcdf ,_eeba :=range _aeda {for _efae ,_cggf :=range _aeda {if _gcdf !=_efae {_aacg ,_gaeg :=_bbc (*_eeba ,*_cggf );if _aacg {_feg (_cggf ,_gaeg );};};};};};

// Redact executes the redact operation on a pdf file and updates the content streams of all pages of the file.
func (_fcce *Redactor )Redact ()error {_gcgf ,_afgg :=_fcce ._abgca .GetNumPages ();if _afgg !=nil {return _d .Errorf ("\u0066\u0061\u0069\u006c\u0065\u0064 \u0074\u006f\u0020\u0067\u0065\u0074\u0020\u0074\u0068\u0065\u0020\u006e\u0075m\u0062\u0065\u0072\u0020\u006f\u0066\u0020P\u0061\u0067\u0065\u0073");
};_dgg :=_fcce ._cea .FillColor ;_fcbg :=_fcce ._cea .BorderWidth ;_aaab :=_fcce ._cea .FillOpacity ;for _fbc :=1;_fbc <=_gcgf ;_fbc ++{_dca ,_addb :=_fcce ._abgca .GetPage (_fbc );if _addb !=nil {return _addb ;};_eeg ,_addb :=_b .New (_dca );if _addb !=nil {return _addb ;
};_gcfe ,_ ,_ ,_addb :=_eeg .ExtractPageText ();if _addb !=nil {return _addb ;};_fcbge :=_gcfe .GetContentStreamOps ();_ebdb ,_fdag ,_addb :=_fcce .redactPage (_fcbge ,_dca .Resources );if _fdag ==nil {_af .Log .Info ("N\u006f\u0020\u006d\u0061\u0074\u0063\u0068\u0020\u0066\u006f\u0075\u006e\u0064\u0020\u0066\u006f\u0072\u0020t\u0068\u0065\u0020\u0070\u0072\u006f\u0076\u0069\u0064\u0065d \u0070\u0061\u0074t\u0061r\u006e\u002e");
_fdag =_fcbge ;};_gfa :=_gb .ContentStreamOperation {Operand :"\u006e"};*_fdag =append (*_fdag ,&_gfa );_dca .SetContentStreams ([]string {_fdag .String ()},_fd .NewFlateEncoder ());if _addb !=nil {return _addb ;};_aee ,_addb :=_dca .GetMediaBox ();if _addb !=nil {return _addb ;
};if _dca .MediaBox ==nil {_dca .MediaBox =_aee ;};if _cffb :=_fcce ._dag .AddPage (_dca );_cffb !=nil {return _cffb ;};_eeb .Slice (_ebdb ,func (_ccb ,_aaba int )bool {return _ebdb [_ccb ]._dce < _ebdb [_aaba ]._dce });_gafe :=_aee .Ury ;for _ ,_fea :=range _ebdb {_dage :=_fea ._cdca ;
_fec :=_fcce ._dag .NewRectangle (_dage .Llx ,_gafe -_dage .Lly ,_dage .Urx -_dage .Llx ,-(_dage .Ury -_dage .Lly ));_fec .SetFillColor (_dgg );_fec .SetBorderWidth (_fcbg );_fec .SetFillOpacity (_aaab );if _gab :=_fcce ._dag .Draw (_fec );_gab !=nil {return nil ;
};};};_fcce ._dag .SetOutlineTree (_fcce ._abgca .GetOutlineTree ());return nil ;};func _gge (_bfce []*matchedIndex ,_edd [][]int )[]*matchedIndex {_dfedb :=[]*matchedIndex {};for _ ,_fcad :=range _bfce {_fgd ,_fggf :=_gdgb (_fcad ,_edd );if _fgd {_gbb :=_fadd (_fcad ,_fggf );
_dfedb =append (_dfedb ,_gbb ...);}else {_dfedb =append (_dfedb ,_fcad );};};return _dfedb ;};